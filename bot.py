import os
import json
import asyncio
import aiohttp
import logging
from datetime import datetime
import random
import time

# Configuration
TELEGRAM_BOT_TOKEN = os.environ.get('TELEGRAM_BOT_TOKEN', '')
TELEGRAM_CHAT_ID = os.environ.get('TELEGRAM_CHAT_ID', '')
STEAM_API_KEY = os.environ.get('STEAM_API_KEY', '')


STEAM_ACCOUNTS = [
    '76561197992247587','76561197992612521','76561197993496879','76561197993592948','76561197993802987','76561197993947784',
'76561197993994226','76561197994070923','76561197994380456','76561197994614921','76561197994815106','76561197994836749',
'76561197994875149','76561197994968274','76561197995075777','76561197995131073','76561197995250218','76561197996081384',
'76561197996282976','76561197996398575','76561197996593424','76561197996675026','76561197997017699','76561197997086477',
'76561197997141383','76561197997251442','76561197997427804','76561197997700403','76561197998365855','76561197998641373',
'76561197998681459','76561197998776248','76561197998852994','76561197999271462','76561197999359231','76561197999432650',
'76561197999556739','76561197999937040','76561197999980555','76561198000388892','76561198000534531','76561198000651707',
'76561198000784002','76561198000818984','76561198001089298','76561198001556761','76561198001619698','76561198001759912',
'76561198001974200','76561198002256476','76561198002340823','76561198002349549','76561198002459076','76561198002459750',
'76561198002554419','76561198003044105','76561198003207494','76561198003388842','76561198003476125','76561198004707936',
'76561198004805385','76561198004832305','76561198005191036','76561198005198966','76561198005900730','76561198005912702',
'76561198005999650','76561198006034833','76561198006051612','76561198006117832','76561198006367911','76561198006697194',
'76561198006706212','76561198006819655','76561198007055256','76561198007471136','76561198007799475','76561198007919087',
'76561198008296760','76561198008531439','76561198008633057','76561198008706562','76561198008896023','76561198009060713',
'76561198009188599','76561198009295963','76561198009427867','76561198009824969','76561198009833895','76561198010136751',
'76561198010179885','76561198010370267','76561198011047529','76561198011104186','76561198011218548','76561198011381688',
'76561198011453078','76561198011511861','76561198011678928','76561198011942597','76561198012012675','76561198012175452',
'76561198012243254','76561198012393433','76561198012593717','76561198012708397','76561198012761378','76561198012789099',
'76561198012825733','76561198013215682','76561198013288262','76561198013598292','76561198013615882','76561198013626622',
'76561198013641401','76561198014135072','76561198014286820','76561198014551891','76561198014686146','76561198014705555',
'76561198015235796','76561198015671463','76561198015720299','76561198016426731','76561198016996825','76561198017222642',
'76561198017651325','76561198018360376','76561198018550346','76561198019564419','76561198019895271','76561198020008419',
'76561198020304487','76561198020835117','76561198021809052','76561198022710386','76561198024152078','76561197988058514',
'76561197988337937','76561197989199990','76561197989452649','76561197990430309','76561197990808814','76561197990949327',
'76561197990982690','76561197991111102','76561197991643260','76561197991843754','76561197992198029','76561197992278826',
'76561197992308818','76561197992494240','76561197992617515','76561197993063936','76561197993399332','76561197993497963',
'76561197993698556','76561197993728657','76561197993861914','76561197994397979','76561197994652263','76561197994708101',
'76561197995660731','76561197995779615','76561197995934124','76561197996337196','76561197996390423','76561197996409136',
'76561197996601446','76561197996650939','76561197996728674','76561197997115871','76561197997817102','76561197997876005',
'76561197998376505','76561197998379469','76561197998665444','76561197998708346','76561197998784979','76561197999130852',
'76561197999244441','76561197999378442','76561197999691778','76561197999785281','76561198000195065','76561198000683813',
'76561198000891412','76561198001240173','76561198001365732','76561198001491647','76561198002393790','76561198003272275',
'76561198003839832','76561198003860602','76561198004064329','76561198004290197','76561198004686926','76561198004866054',
'76561198005106330','76561198005344373','76561198005522139','76561198005704244','76561198006002389','76561198006073597',
'76561198006444165','76561198006723784','76561198006848366','76561198007872748','76561198008301969','76561198008414837',
'76561198008775645','76561198008952582','76561198009216029','76561198009738125','76561198009873730','76561198010203436',
'76561198010311684','76561198010543100','76561198010825182','76561198010872668','76561198011455098','76561198011463121',
'76561198012017552','76561198012857228','76561198012999234','76561198013143045','76561198013675938','76561198014029550',
'76561198014392702','76561198014806014','76561198015352402','76561198015473371','76561198015570163','76561198015579681',
'76561198015975344','76561198015986916','76561198016751088','76561198017062540','76561198017187811','76561198017468047',
'76561198017848098','76561198017896821','76561198017899735','76561198018109488','76561198018374462','76561198018477188',
'76561198019298402','76561198020956106','76561198021253681','76561198022450297','76561198023265169','76561198023795806',
'76561197987964262','76561197988489619','76561197988824710','76561197989496786','76561197989810823','76561197990936071',
'76561197990946931','76561197991745275','76561197992312224','76561197992334332','76561197992437670','76561197993101612',
'76561197993110200','76561197993282532','76561197993333083','76561197993626623','76561197993644094','76561197994008402',
'76561197994028009','76561197994555248','76561197994600845','76561197994706685','76561197995046201','76561197995108375',
'76561197995136266','76561197995383162','76561197995559473','76561197995673522','76561197995746047','76561197996124462',
'76561197996396983','76561197996409457','76561197996503673','76561197996910299','76561197996984799','76561197997301575',
'76561197997348057','76561197997478176','76561197998473482','76561197998799146','76561197998834770','76561197998839623',
'76561197999099725','76561197999123729','76561197999341072','76561197999398883','76561198000007757','76561198000108542',
'76561198000187186','76561198000241926','76561198000361424','76561198000708194','76561198000900670','76561198001753775',
'76561198001812428','76561198002077183','76561198002114585','76561198002484896','76561198002505715','76561198002993481',
'76561198003016879','76561198003404664','76561198003580513','76561198003651672','76561198003690834','76561198003833799',
'76561198003923750','76561198003971749','76561198004313186','76561198005162594','76561198005410915','76561198006018636',
'76561198006143803','76561198006145052','76561198006209655','76561198007001219','76561198007476501','76561198007561801',
'76561198007580445','76561198007719058','76561198007846716','76561198008025836','76561198008113072','76561198008385468',
'76561198009364071','76561198009687590','76561198009939285','76561198010070623','76561198010253298','76561198010479989',
'76561198010683096','76561198010783959','76561198010841989','76561198010917612','76561198011131422','76561198011379600',
'76561198011501934','76561198012634588','76561198012634894','76561198012888100','76561198013060240','76561198013564878',
'76561198013686737','76561198013703739','76561198013757814','76561198013767576','76561198013838601','76561198014160193',
'76561198014576815','76561198015046488','76561198015322573','76561198015482503','76561198015585195','76561198015768994',
'76561198015780224','76561198015836587','76561198015908980','76561198015943586','76561198016297422','76561198016373785',
'76561198016391900','76561198016416238','76561198016465354','76561198016583602','76561198016774173','76561198017111197',
'76561198018064227','76561198018249715','76561198018425120','76561198018482639','76561198019057854','76561198020922949',
'76561198021048258','76561198021781218','76561198021794950','76561198022330646','76561198022405096','76561198022724042',
'76561198024012033','76561199191549422','76561197989193395','76561197989493336','76561197989520345','76561197990143390',
'76561197990943244','76561197991024740','76561197991651693','76561197991754589','76561197991866728','76561197991915984',
'76561197992230198','76561197992337972','76561197992485147','76561197992517462','76561197992644082','76561197992684484',
'76561197992745652','76561197992849415','76561197992862199','76561197993221750','76561197993350225','76561197993399102',
'76561197993672815','76561197994162897','76561197994399633','76561197994746916','76561197994974370','76561197995360419',
'76561197995581168','76561197995644952','76561197995721351','76561197996094340','76561197996343337','76561197996528131',
'76561197996848155','76561197997877272','76561197998120961','76561197998513108','76561197998976137','76561197999320977',
'76561197999559838','76561198000256220','76561198001492599','76561198002095700','76561198002806294','76561198003197624',
'76561198004049271','76561198004180185','76561198004429394','76561198004713083','76561198004727705','76561198004875238',
'76561198004985423','76561198005471010','76561198005511310','76561198005652686','76561198005756844','76561198005828188',
'76561198005917132','76561198006012952','76561198006184016','76561198006489197','76561198006835753','76561198006851285',
'76561198007570550','76561198007796776','76561198007895286','76561198007943808','76561198008452550','76561198008496002',
'76561198009064294','76561198009117461','76561198009476086','76561198009805209','76561198009938778','76561198010151984',
'76561198010507141','76561198010778422','76561198011127856','76561198011501645','76561198011960176','76561198012231622',
'76561198012392711','76561198012627290','76561198012919357','76561198013284957','76561198013372961','76561198014918618',
'76561198015286141','76561198015792900','76561198016386321','76561198016421478','76561198016714551','76561198016793798',
'76561198017073543','76561198017296449','76561198018604414','76561198018868871','76561198019303353','76561198020223500',
'76561198020351916','76561198020753539','76561198021141736','76561198021635058','76561198021796772','76561198023993859',
'76561197987794341','76561197987852194','76561197988289756','76561197989846446','76561197990198543','76561197990592745',
'76561197990965501','76561197990997233','76561197991313381','76561197991410271','76561197991658749','76561197992026485',
'76561197992273780','76561197992340844','76561197992444625','76561197992583495','76561197992613082','76561197992670878',
'76561197992789112','76561197993184958','76561197993204644','76561197993485850','76561197993662838','76561197993826617',
'76561197993966698','76561197993980079','76561197993980361','76561197994026142','76561197994067621','76561197994242131',
'76561197994264900','76561197994890994','76561197994897149','76561197994936681','76561197995051949','76561197995064714',
'76561197995163860','76561197995197087','76561197995397470','76561197995413209','76561197995555409','76561197995700455',
'76561197996005985','76561197996533380','76561197996669122','76561197997047431','76561197997920055','76561197998468439',
'76561197998509095','76561197999169955','76561197999200727','76561197999309204','76561197999498116','76561197999570776',
'76561197999790921','76561197999822567','76561198000007662','76561198000041198','76561198000074277','76561198000271076',
'76561198000327822','76561198000412759','76561198000584886','76561198001025965','76561198001836862','76561198001851721',
'76561198002092164','76561198002289776','76561198002456339','76561198002534583','76561198003165497','76561198003234354',
'76561198003641627','76561198003896590','76561198004165759','76561198004216317','76561198005482461','76561198005578093',
'76561198005626607','76561198005729376','76561198005854934','76561198005917638','76561198005986234','76561198005989136',
'76561198006487801','76561198006505594','76561198006593579','76561198006620987','76561198006693993','76561198007101834',
'76561198007178143','76561198007898862','76561198007923170','76561198007960588','76561198008214903','76561198008258685',
'76561198008393717','76561198008555259','76561198009046393','76561198009099488','76561198009507546','76561198009917546',
'76561198009937883','76561198009964931','76561198010116882','76561198010664826','76561198011195238','76561198011207909',
'76561198011383143','76561198011721239','76561198011944474','76561198012062927','76561198012463730','76561198012641643',
'76561198012755237','76561198012758124','76561198012763807','76561198012789350','76561198012795672','76561198013099354',
'76561198013373828','76561198013449649','76561198013593877','76561198013684791','76561198013694203','76561198013793046',
'76561198013993832','76561198014376585','76561198014505097','76561198014582086','76561198014782554','76561198014989143',
'76561198015039552','76561198015040474','76561198015154051','76561198015792906','76561198015814357','76561198015827618',
'76561198015959697','76561198015976672','76561198016687805','76561198016975761','76561198017316713','76561198017738334',
'76561198017869245','76561198018024666','76561198018751114','76561198019133503','76561198019730760','76561198021131905',
'76561198021137745','76561198024752010','76561197989610687','76561197989692231','76561197989907960','76561197989954608',
'76561197990348687','76561197990684290','76561197990745543','76561197991083653','76561197991174859','76561197991364569',
'76561197991507132','76561197991545137','76561197991602715','76561197991780299','76561197992134125','76561197992225779',
'76561197992281548','76561197992426025','76561197992430257','76561197992528104','76561197992557391','76561197992583661',
'76561197993002664','76561197993138986','76561197993257717','76561197993313243','76561197993893431','76561197993921228',
'76561197994100846','76561197994454878','76561197994520063','76561197994699425','76561197994873603','76561197995046990',
'76561197995164541','76561197995289540','76561197995381114','76561197995629501','76561197995876783','76561197996066209',
'76561197996178209','76561197996383777','76561197996507368','76561197996521772','76561197996669089','76561197996849001',
'76561197997001267','76561197997001787','76561197997541317','76561197997548645','76561197997853909','76561197998537551',
'76561197998832888','76561197999040436','76561197999523054','76561197999639548','76561197999964656','76561198000136565',
'76561198000217764','76561198000240937','76561198000325125','76561198000375976','76561198000581411','76561198000772916',
'76561198000869260','76561198001082568','76561198001146848','76561198001547967','76561198001676416','76561198001759184',
'76561198001788186','76561198002322774','76561198002603147','76561198002884545','76561198002941580','76561198003093338',
'76561198003161216','76561198003218747','76561198003266657','76561198003307816','76561198003377227','76561198003459597',
'76561198003485854','76561198003564443','76561198003717602','76561198003805796','76561198004010872','76561198004026681',
'76561198004203326','76561198004311568','76561198004321176','76561198004392667','76561198004699018','76561198004737635',
'76561198004850223','76561198005288585','76561198005399623','76561198005401482','76561198006175943','76561198006418119',
'76561198006486289','76561198007115220','76561198007142301','76561198007253583','76561198007523756','76561198007536035',
'76561198008194047','76561198008464788','76561198008470286','76561198009169253','76561198010443794','76561198010465556',
'76561198010492464','76561198010693467','76561198011494401','76561198011634198','76561198011806285','76561198012015677',
'76561198012227998','76561198012263983','76561198012547100','76561198012571394','76561198012833188','76561198012844908',
'76561198013119806','76561198013483761','76561198013616589','76561198013659594','76561198013851035','76561198013884162',
'76561198013954404','76561198014117841','76561198014381831','76561198014570967','76561198014849776','76561198014856211',
'76561198014908087','76561198014963115','76561198015025939','76561198015078173','76561198015329381','76561198016196360',
'76561198016623563','76561198016988280','76561198017017918','76561198017248637','76561198017248846','76561198019628871',
'76561198020090322','76561198020138430','76561198020164998','76561198020874107','76561198021104771','76561198022431407',
'76561198022604141','76561198022881908','76561197987498393','76561197987901914','76561197988189611','76561197988887904',
'76561197990582687','76561197990758433','76561197990810338','76561197991044073','76561197991529725','76561197991617165',
'76561197991679498','76561197991725293','76561197992391100','76561197992475305','76561197992654728','76561197992759861',
'76561197992794592','76561197992896767','76561197993489188','76561197993755588','76561197994079059','76561197994166842',
'76561197994298197','76561197994596536','76561197994824067','76561197995104009','76561197995205851','76561197995218191',
'76561197995584796','76561197996176563','76561197996248235','76561197996313411','76561197996335939','76561197996523113',
'76561197997161040','76561197997867646','76561197998610522','76561197998720571','76561197998869688','76561197999543619',
'76561197999571146','76561198000100496','76561198000413568','76561198000886420','76561198000931972','76561198001197445',
'76561198001313404','76561198001338122','76561198001435083','76561198001796791','76561198001828291','76561198002265921',
'76561198002379617','76561198002490865','76561198002896410','76561198003004417','76561198003268913','76561198003283383',
'76561198003359460','76561198003737190','76561198004050065','76561198004195232','76561198004699229','76561198005194242',
'76561198005505763','76561198005694671','76561198005893336','76561198005928472','76561198006048841','76561198006388708',
'76561198006676649','76561198006942015','76561198007057317','76561198007279755','76561198007495124','76561198007554830',
'76561198007568074','76561198007665759','76561198007817547','76561198008422235','76561198008722722','76561198008735015',
'76561198008808151','76561198008853666','76561198009277430','76561198009392066','76561198009658470','76561198010136442',
'76561198010340567','76561198010947109','76561198011051432','76561198011413704','76561198011644346','76561198011694971',
'76561198011707516','76561198011858733','76561198012333613','76561198012540863','76561198012707332','76561198012826892',
'76561198012913654','76561198012999241','76561198013580708','76561198013592040','76561198013598867','76561198013621748',
'76561198013751360','76561198013803671','76561198014227194','76561198014328422','76561198014464776','76561198014784724',
'76561198015161995','76561198015283395','76561198015291073','76561198015346139','76561198015733552','76561198015775975',
'76561198015857532','76561198016056721','76561198016062125','76561198016080625','76561198016100287','76561198016144070',
'76561198016181896','76561198016390711','76561198016938740','76561198017068136','76561198017230028','76561198017282517',
'76561198017510812','76561198017517086','76561198017789626','76561198018317439','76561198018660705','76561198018663219',
'76561198018720562','76561198018725938','76561198018779085','76561198018822529','76561198018890798','76561198020398410',
'76561198021580023','76561198022827234','76561198023273514','76561198023425499','76561198023589811','76561198024025102',
'76561198863338524','76561198008410715','76561198434039453','76561197988086676','76561197988584575','76561197989120643',
'76561197990835158','76561197991124788','76561197991176005','76561197991233662','76561197991327643','76561197991380895',
'76561197991426990','76561197991480879','76561197991728029','76561197992521406','76561197992885000','76561197992953168',
'76561197993227306','76561197993269048','76561197993466743','76561197993486144','76561197993563683','76561197993565863',
'76561197993614300','76561197993638279','76561197993836949','76561197993867483','76561197994096156','76561197994271180',
'76561197995029313','76561197995434733','76561197995669228','76561197996398213','76561197996402726','76561197996859470',
'76561197997138605','76561197997200196','76561197997407633','76561197997463130','76561197997679636','76561197997717408',
'76561197997832451','76561197997934346','76561197999111640','76561197999746522','76561197999890772','76561198000033394',
'76561198000091885','76561198000321964','76561198000423226','76561198000593283','76561198000606412','76561198000648763',
'76561198000720794','76561198000859983','76561198000986514','76561198001415988','76561198001785922','76561198002052773',
'76561198002122143','76561198002169434','76561198002356295','76561198002411122','76561198002453976','76561198002637246',
'76561198002768409','76561198002989743','76561198003124831','76561198003370639','76561198003407951','76561198003537060',
'76561198003727628','76561198003935854','76561198004012902','76561198004120749','76561198004191633','76561198004459713',
'76561198004552561','76561198004739811','76561198004868880','76561198005195037','76561198005284017','76561198005354381',
'76561198005398606','76561198005454058','76561198005791197','76561198005922457','76561198006187767','76561198006720611',
'76561198006749416','76561198007252952','76561198007466260','76561198007503068','76561198007658768','76561198008172334',
'76561198008336921','76561198008869508','76561198008991965','76561198009291767','76561198009424606','76561198009798502',
'76561198009823791','76561198009978805','76561198010008904','76561198010048254','76561198010308601','76561198010523541',
'76561198010577830','76561198010906834','76561198011012185','76561198011140819','76561198011258882','76561198011283393',
'76561198011294713','76561198011303247','76561198011678923','76561198011792870','76561198011805718','76561198011832772',
'76561198012259769','76561198012509761','76561198012594017','76561198012737262','76561198012761483','76561198012826202',
'76561198012946961','76561198013793446','76561198014271567','76561198014808206','76561198014948266','76561198015636253',
'76561198015916635','76561198015998886','76561198016019570','76561198016302379','76561198016431600','76561198016578174',
'76561198016624457','76561198017591465','76561198017831769','76561198017936128','76561198018154865','76561198018235859',
'76561198018763006','76561198018777674','76561198018974882','76561198019376161','76561198021594201','76561198021735132',
'76561198022721456','76561198024170857','76561197987791931','76561197988519423','76561197988749170','76561197989561919',
'76561197989857928','76561197990658616','76561197991053979','76561197991740217','76561197992047305','76561197992172262',
'76561197992177645','76561197992352164','76561197992517609','76561197992672484','76561197992839996','76561197993029534',
'76561197993250462','76561197993438826','76561197993441224','76561197993627571','76561197993698664','76561197993756319',
'76561197993758428','76561197993982678','76561197994131031','76561197994175059','76561197994277619','76561197994304416',
'76561197994669644','76561197994714617','76561197994802258','76561197995036351','76561197995230235','76561197995270994',
'76561197995276071','76561197995815178','76561197995981142','76561197996099190','76561197996480654','76561197997306740',
'76561197997547539','76561197998548551','76561197998563121','76561197998678257','76561197998901190','76561197998962845',
'76561197998986272','76561197999193301','76561197999266608','76561197999460983','76561197999799999','76561197999841133',
'76561197999989982','76561198000528856','76561198000632452','76561198000893012','76561198001180588','76561198001213576',
'76561198001376757','76561198001859966','76561198002252932','76561198002336613','76561198002416727','76561198002453874',
'76561198002499560','76561198002782654','76561198002947256','76561198003138142','76561198003356293','76561198003437094',
'76561198004490984','76561198004708290','76561198004795062','76561198004900844','76561198005646071','76561198005836852',
'76561198005838333','76561198005930268','76561198006596013','76561198007600868','76561198007826856','76561198007831274',
'76561198008193138','76561198008749356','76561198008819453','76561198009063338','76561198009368451','76561198009556061',
'76561198009609186','76561198009713017','76561198009906929','76561198010122077','76561198010310996','76561198010413449',
'76561198010809406','76561198010867499','76561198010931047','76561198011124439','76561198011201592','76561198011300609',
'76561198011309424','76561198011460917','76561198011488468','76561198011627374','76561198012149248','76561198012243252',
'76561198012695319','76561198013144392','76561198013458365','76561198013492794','76561198013942078','76561198014090532',
'76561198014326037','76561198014445286','76561198014885680','76561198014991073','76561198015701595','76561198015743753',
'76561198015763932','76561198015877207','76561198015880548','76561198016469813','76561198016589896','76561198016841816',
'76561198018963448','76561198019072226','76561198019089326','76561198025310121','76561197988727181','76561197989141351',
'76561197989282607','76561197989931184','76561197990010899','76561197990100212','76561197990446870','76561197991041363',
'76561197991181943','76561197991261002','76561197991613060','76561197991633543','76561197991690707','76561197991734227',
'76561197991829631','76561197991925937','76561197991976788','76561197992103538','76561197992322581','76561197992369815',
'76561197992422847','76561197993456074','76561197993474133','76561197993547739','76561197993705261','76561197994296085',
'76561197994373908','76561197994396459','76561197994713230','76561197994929776','76561197995016334','76561197995576695',
'76561197995595777','76561197995758601','76561197995974073','76561197996062831','76561197996345552','76561197996403344',
'76561197996678856','76561197996734746','76561197996948748','76561197997017121','76561197997128237','76561197997308290',
'76561197997543579','76561197997552456','76561197997565461','76561197997642727','76561197998094762','76561197998152008',
'76561197998266076','76561197998593809','76561197998594410','76561197998874709','76561197998929107','76561197999864226',
'76561197999937397','76561198000076597','76561198000699106','76561198000952250','76561198001181224','76561198001669875',
'76561198001760493','76561198001933717','76561198002633374','76561198002879022','76561198003269679','76561198003306468',
'76561198003483656','76561198003669460','76561198003825092','76561198004390293','76561198004735810','76561198004774049',
'76561198004804828','76561198005299057','76561198005386177','76561198005447888','76561198006162028','76561198006683729',
'76561198006750894','76561198006827937','76561198007321059','76561198007339790','76561198007380514','76561198007421968',
'76561198007637119','76561198007681631','76561198008222825','76561198008270761','76561198008421512','76561198008890156',
'76561198008939518','76561198009209328','76561198009717775','76561198009830774','76561198009869693','76561198009883071',
'76561198010203206','76561198010302055','76561198010304075','76561198010323886','76561198010491299','76561198010834571',
'76561198010849317','76561198011142104','76561198011685399','76561198011724676','76561198012237349','76561198012415968',
'76561198012650008','76561198012650662','76561198012899770','76561198012932056','76561198012989770','76561198013160599',
'76561198013564724','76561198013571487','76561198013954380','76561198014454426','76561198014679188','76561198014989802',
'76561198015116592','76561198015253784','76561198015408826','76561198015766078','76561198015999231','76561198016128515',
'76561198016514389','76561198016731829','76561198016944856','76561198016997509','76561198016998726','76561198017206757',
'76561198017606782','76561198018067934','76561198018176898','76561198018221561','76561198018302061','76561198018504530',
'76561198019333901','76561198019544694','76561198021399657','76561198024301690','76561198024749763','76561198887621975',
'76561199515450740','76561198227229872','76561199208769883','76561199079108071','76561198283355423','76561197987752686',
'76561197987888417','76561197988176563','76561197988593470','76561197989247444','76561197989690508','76561197989823902',
'76561197989969891','76561197990469526','76561197990484446','76561197991352892','76561197991383136','76561197991509511',
'76561197991619672','76561197991760334','76561197991927666','76561197991938072','76561197992109396','76561197992202515',
'76561197992736076','76561197992926652','76561197992977580','76561197993022629','76561197993051320','76561197993290134',
'76561197993354466','76561197993510791','76561197993848315','76561197993896795','76561197993932500','76561197993981407',
'76561197993989343','76561197994003032','76561197994374823','76561197994411831','76561197994532571','76561197994890051',
'76561197995050150','76561197995116721','76561197995288622','76561197995708227','76561197996699518','76561197997270647',
'76561197997411656','76561197997683061','76561197997859777','76561197997861604','76561197998110590','76561197998146760',
'76561197998531733','76561197998810116','76561197999409067','76561197999516673','76561197999685865','76561198000412380',
'76561198000414336','76561198000587766','76561198000620883','76561198000692958','76561198000859552','76561198000890124',
'76561198001035480','76561198001071761','76561198001109031','76561198001307539','76561198001765057','76561198002004019',
'76561198002121513','76561198002427097','76561198002597392','76561198002742265','76561198002778015','76561198002928390',
'76561198002955197','76561198003035005','76561198003057206','76561198003153130','76561198003850184','76561198004003121',
'76561198004060795','76561198004931277','76561198005129629','76561198005134266','76561198005288800','76561198005303657',
'76561198005704574','76561198006282000','76561198006286793','76561198006388731','76561198006391497','76561198006518330',
'76561198006600509','76561198006658987','76561198006741156','76561198007399624','76561198007429086','76561198007819701',
'76561198007984237','76561198008046175','76561198008335098','76561198009005723','76561198009165059','76561198009291134',
'76561198009369185','76561198010051754','76561198010314748','76561198010393250','76561198010617273','76561198010629421',
'76561198010725130','76561198011237376','76561198011246207','76561198011314315','76561198011761610','76561198011816071',
'76561198011885828','76561198012087752','76561198012263872','76561198012412177','76561198012432730','76561198012448721',
'76561198012597637','76561198012678558','76561198012804020','76561198013030366','76561198013049681','76561198013364641',
'76561198013733899','76561198013809215','76561198013867526','76561198014027482','76561198014230223','76561198014382299',
'76561198014398292','76561198015086950','76561198015291103','76561198015335601','76561198015775219','76561198016090807',
'76561198016120293','76561198016254141','76561198016474578','76561198016586064','76561197993673003','76561197993697526',
'76561197993703816','76561197993818059','76561197994292915','76561197994585068','76561197994595538','76561197994603498',
'76561197994957426','76561197995417944','76561197995822999','76561197995905873','76561197996301464','76561197996400489',
'76561197996589023','76561197996698705','76561197996881607','76561197996940060','76561197997030841','76561197997091969',
'76561197997351433','76561197997959166','76561197998189145','76561197998509762','76561197998961757','76561197998965006',
'76561197998977149','76561197998999903','76561197999003271','76561197999039088','76561197999072620','76561197999130223',
'76561197999395808','76561197999522451','76561197999641928','76561198000051548','76561198000561261','76561198000732105',
'76561198000951944','76561198001363909','76561198001369193','76561198001610896','76561198002045213','76561198002128077',
'76561198002306679','76561198002411266','76561198002508514','76561198002560675','76561198003034079','76561198003036590',
'76561198003150835','76561198003180749','76561198003629389','76561198003792940','76561198003922485','76561198004322494',
'76561198004440213','76561198004614501','76561198004715290','76561198004865895','76561198004892452','76561198005004399',
'76561198005134750','76561198005202606','76561198005262367','76561198005301546','76561198005431399','76561198005485751',
'76561198005727190','76561198005777622','76561198005902233','76561198006041936','76561198006077379','76561198006406948',
'76561198006598861','76561198007009773','76561198007279978','76561198007607556','76561198007698506','76561198007716870',
'76561198007765791','76561198007800634','76561198008132618','76561198008193052','76561198008648774','76561198008673682',
'76561198008749887','76561198008798853','76561198009065096','76561198009146276','76561198009756525','76561198009839031',
'76561198009903916','76561198009932612','76561198009961540','76561198010028226','76561198010097849','76561198010127370',
'76561198010172139','76561198010500152','76561198010590129','76561198010633132','76561198010707816','76561198011005104',
'76561198011013220','76561198011060852','76561198011433239','76561198011851877','76561198012094273','76561198012106526',
'76561198012270800','76561198012273934','76561198012353488','76561198012484047','76561198012904919','76561198012943151',
'76561198013457887','76561198013706684','76561198013735217','76561198014326668','76561198014488849','76561198014757554',
'76561198015091752','76561198015114681','76561198015288794','76561198015367338','76561198015577370','76561198015658200',
'76561198016091726','76561198016324389','76561198016860020','76561198016864322','76561198016939222','76561198017173075',
'76561198017283473','76561198017357568','76561198017542483','76561198017556185','76561198017829266','76561198017830360',
'76561198017987478','76561198018175253','76561198018384120','76561198018460702','76561198018783047','76561198018818898',
'76561198019694383','76561198021067177','76561198021327889','76561198021878602','76561198021986586','76561198022677712',
'76561198022899962','76561198023034689','76561198023089037','76561198023414015','76561198024826979','76561198306279460',
'76561197987582794','76561197987688035','76561197989320642','76561197989549190','76561197989939709','76561197989986087',
'76561197990377764','76561197990395224','76561197990886602','76561197991017298','76561197991129525','76561197991159560',
'76561197991299158','76561197991312260','76561197991537311','76561197991924347','76561197992131360','76561197992354030',
'76561197992386889','76561197992388118','76561197992489715','76561197992614194','76561197992669333','76561197992793626',
'76561197992872251','76561197993028965','76561197993089410','76561197993179302','76561197993249711','76561197993376960',
'76561197993430507','76561197993909315','76561197994034307','76561197994061230','76561197994089745','76561197994128364',
'76561197994215685','76561197994333059','76561197994535362','76561197994541975','76561197994561339','76561197994723683',
'76561197995068669','76561197995389471','76561197995764327','76561197996032666','76561197996528703','76561197996724545',
'76561197996867070','76561197996890499','76561197997210582','76561197997216742','76561197997535398','76561197997562258',
'76561197998323324','76561197998636292','76561197998698187','76561197999042084','76561197999634406','76561197999661388',
'76561197999797290','76561198000824176','76561198001018868','76561198001112179','76561198001645715','76561198001779786',
'76561198001914363','76561198001962278','76561198001991574','76561198002113071','76561198002212216','76561198002632365',
'76561198002950928','76561198002969715','76561198002978159','76561198003371847','76561198003875795','76561198003922279',
'76561198004210506','76561198004499459','76561198005128825','76561198005189200','76561198005412769','76561198005522651',
'76561198005545224','76561198005792146','76561198005821067','76561198005899212','76561198005991632','76561198006115382',
'76561198006230389','76561198006280197','76561198007188722','76561198007949856','76561198008002889','76561198008125027',
'76561198008272247','76561198008320588','76561198008411387','76561198008652194','76561198008657789','76561198008810014',
'76561198008815200','76561198008878038','76561198009203617','76561198009349050','76561198009584406','76561198009640247',
'76561198010124459','76561198010195867','76561198010400215','76561198010505106','76561198010674365','76561198010708115',
'76561198010832747','76561198010874504','76561198011095306','76561198011852912','76561198012083260','76561198012263252',
'76561198012370235','76561198012562387','76561198012973260','76561198013071012','76561198013176407','76561198013900274',
'76561198014166560','76561198014237045','76561198014559676','76561198014582823','76561198014942257','76561198015059837',
'76561198015287135','76561198015391843','76561198015678571','76561198015844261','76561198015883077','76561198016139035',
'76561198016365246','76561198017348969','76561198017674679','76561198017696003','76561198018137382','76561198018848053',
'76561198018967133','76561198019781775','76561198020739971','76561198021163466','76561198021344579','76561198021630185',
'76561198022000587','76561198022965049','76561198023142576','76561197987999665','76561197988161875','76561197990482436',
'76561197990725442','76561197990929247','76561197991210546','76561197991362078','76561197991366250','76561197991462799',
'76561197991482690','76561197991748277','76561197991812561','76561197991820443','76561197991935900','76561197992129535',
'76561197992222758','76561197992677368','76561197992825116','76561197993088244','76561197993237642','76561197993242935',
'76561197993380477','76561197993707616','76561197993837107','76561197994064030','76561197994272516','76561197994335988',
'76561197994461409','76561197994606390','76561197994924490','76561197994977677','76561197995104382','76561197995513613',
'76561197995520419','76561197996038633','76561197996047529','76561197996121074','76561197996960665','76561197997609572',
'76561197997831930','76561197998520071','76561197998576601','76561197998665077','76561197998734706','76561197998775955',
'76561197998793234','76561197998798101','76561197999709455','76561197999985414','76561198000107602','76561198000417060',
'76561198000450453','76561198000522943','76561198000527065','76561198000788033','76561198000884276','76561198000939339',
'76561198001040223','76561198001231818','76561198001402727','76561198001482635','76561198001558935','76561198001700500',
'76561198001723248','76561198002147111','76561198002237580','76561198002433958','76561198002476702','76561198003433083',
'76561198003528971','76561198003869198','76561198004172324','76561198004235544','76561198004336259','76561198004840852',
'76561198005067716','76561198005216338','76561198005682947','76561198005706367','76561198005799199','76561198006183678',
'76561198006188915','76561198006251670','76561198006333375','76561198006365652','76561198006423583','76561198006650312',
'76561198006784825','76561198007122643','76561198007384821','76561198007516525','76561198007752477','76561198007953245',
'76561198008034872','76561198008163540','76561198008262186','76561198008537344','76561198008790788','76561198009015582',
'76561198009414406','76561198009442631','76561198009883062','76561198009937151','76561198009979974','76561198010057266',
'76561198010103398','76561198010138821','76561198010540978','76561198010553240','76561198010603428','76561198010703718',
'76561198010901219','76561198010917735','76561198010939093','76561198011070761','76561198011423701','76561198011594277',
'76561198011712917','76561198011773059','76561198011914643','76561198012175048','76561198012210167','76561198012246119',
'76561198012665504','76561198012735848','76561198012975144','76561198013549298','76561198014231802','76561198014416762',
'76561198014583084','76561198014648461','76561198014770664','76561198015276571','76561198015335834','76561198015716842',
'76561198016173066','76561198016255111','76561198016663585','76561198016833553','76561198016874386','76561198017530164',
'76561198018458754','76561198018654027','76561198018793819','76561198019214836','76561198019329748','76561198020555833',
'76561198020759906','76561198020823424','76561198021870291','76561198021880136','76561198024047606','76561198025489508',
'76561197990954841','76561197991184615','76561197991299777','76561197991988443','76561197992140948','76561197992815705',
'76561197992846767','76561197993072550','76561197993269064','76561197993487014','76561197993685850','76561197994057791',
'76561197994122818','76561197994223235','76561197994294443','76561197994297770','76561197994327890','76561197994637408',
'76561197994646582','76561197994846541','76561197994982003','76561197995686069','76561197995704824','76561197995987813',
'76561197996500184','76561197997132099','76561197997202910','76561197997547084','76561197997596067','76561197998020938',
'76561197998968230','76561197999329580','76561197999525686','76561197999668431','76561198000084467','76561198000374220',
'76561198000698453','76561198000782928','76561198000816057','76561198001415771','76561198001498680','76561198001782606',
'76561198001828747','76561198002175300','76561198002306784','76561198003363695','76561198003606162','76561198004026481',
'76561198004450196','76561198004902204','76561198004933253','76561198005397279','76561198005853665','76561198006336471',
'76561198006801723','76561198006943013','76561198007181374','76561198007365337','76561198007472070','76561198007761765',
'76561198007901022','76561198007920341','76561198008020157','76561198008644308','76561198008727889','76561198009222684',
'76561198009346232','76561198009543848','76561198009573687','76561198009750197','76561198009861319','76561198009963773',
'76561198010252421','76561198010890565','76561198011018297','76561198011562153','76561198011582991','76561198011616181',
'76561198011649557','76561198011758284','76561198011865806','76561198011955457','76561198012384503','76561198012756032',
'76561198012836426','76561198012843479','76561198012980679','76561198013045252','76561198013073888','76561198014520692',
'76561198014535339','76561198014570683','76561198014773747','76561198014823878','76561198014955678','76561198015616207',
'76561198017770670','76561197988167129','76561197988490081','76561197989248204','76561197989921515','76561197989934939',
'76561197990871111','76561197991399585','76561197991567334','76561197991594400','76561197991690182','76561197991952783',
'76561197993110938','76561197993657581','76561197993675728','76561197993756941','76561197994288598','76561197994375645',
'76561197994506825','76561197994618165','76561197995492480','76561197995573929','76561197995633874','76561197996302272',
'76561197996469325','76561197996783662','76561197996867215','76561197997152446','76561197997976730','76561197998660892',
'76561197998842180','76561197998963973','76561197999374889','76561197999710432','76561198000106860','76561198000254183',
'76561198000961744','76561198001037845','76561198001102640','76561198001159087','76561198001552192','76561198001588210',
'76561198001892376','76561198002024828','76561198002540592','76561198002872529','76561198002910946','76561198003234749',
'76561198003406091','76561198003605819','76561198005157426','76561198005168741','76561198005668711','76561198006073218',
'76561198006243699','76561198006589702','76561198006854590','76561198006978854','76561198007769575','76561198008940589',
'76561198009894851','76561198010255372','76561198011093861','76561198011142871','76561198011620928','76561198011630613',
'76561198011854393','76561198012648031','76561198012751358','76561198012960936','76561198012987519','76561198013005092',
'76561198013425790','76561198014048953','76561198015242766','76561198015492868','76561198015684120','76561198015790891',
'76561198015803106','76561198015995163','76561198016502007','76561198016742334','76561198017137929','76561198017220397',
'76561198017323550','76561198017905281','76561198018593430','76561198018776917','76561198021742672','76561198023554373',
'76561198023599368','76561197988921488','76561197989226093','76561197989415907','76561197989940044','76561197991425297',
'76561197991520239','76561197992904877','76561197993111382','76561197993142368','76561197993261692','76561197993296746',
'76561197993361591','76561197993533399','76561197993867229','76561197994020840','76561197994417319','76561197994575475',
'76561197995069993','76561197995214915','76561197995456796','76561197996282007','76561197996625572','76561197996650908',
'76561197996958617','76561197997620135','76561197997750313','76561197997791604','76561197998107295','76561197998366665',
'76561197999235661','76561197999562865','76561197999566012','76561197999744972','76561198000088155','76561198000771973',
'76561198001067790','76561198001115104','76561198001200515','76561198001806541','76561198002572234','76561198002982903',
'76561198003103985','76561198003226982','76561198003292089','76561198003917754','76561198004634616','76561198004744244',
'76561198004881503','76561198004921826','76561198005015588','76561198006028344','76561198006047129','76561198006107578',
'76561198006129907','76561198006144436','76561197995770167','76561197995928455','76561197996260231','76561197996467268',
'76561197996521783','76561197996751572','76561197997847999','76561197997902845','76561197997981476','76561197998207999',
'76561197998217961','76561197998580821','76561197998712891','76561197998722157','76561197998766611','76561197998767726',
'76561197998934831','76561197999323819','76561197999376630','76561197999533687','76561197999673832','76561197999733397',
'76561197999812679','76561197999934226','76561198000264984','76561198000439406','76561198000523253','76561198000584507',
'76561198000617699','76561198000700296','76561198000712143','76561198001157088','76561198001924055','76561198002082921',
'76561198002163667','76561198002282943','76561198002359635','76561198002430863','76561198002765311','76561198002902525',
'76561198002929320','76561198003109707','76561198003309941','76561198003320141','76561198003848036','76561198004095947',
'76561198004141478','76561198004459633','76561198004519584','76561198004570077','76561198004806190','76561198004866854',
'76561198004880566','76561198005117849','76561198005146787','76561198005223636','76561198005250698','76561198005366979',
'76561198005737323','76561198006419588','76561198006578684','76561198006766943','76561198006839573','76561198006934056',
'76561198006940407','76561198007117817','76561198007281489','76561198008511251','76561198008738969','76561198008857637',
'76561198009092463','76561198009437423','76561198009474481','76561198009587537','76561198009826170','76561198009847711',
'76561198010096276','76561198010218657','76561198010362200','76561198010458193','76561198010536954','76561198010575665',
'76561198010672608','76561198010707459','76561198010718096','76561198010760753','76561198010811140','76561198011003219',
'76561198011126579','76561198011330742','76561198011370394','76561198011689830','76561198011915607','76561198012098908',
'76561198012329500','76561198012847337','76561198013128918','76561198013162506','76561198013163438','76561198013466482',
'76561198013973076','76561198013981390',
    #nastena nastyusha
    '76561198034432157', '76561198033249843', '76561198144357621', '76561198180491178',
'76561198352650472', '76561198853234202', '76561199035683390', '76561198833815364', '76561199115133986',
'76561199035524504', '76561199042028144', '76561199046077677', '76561198981485810', '76561198882110310',
'76561199173156143', '76561199100757829', '76561199099416488', '76561199105008648', '76561199220629425',
'76561199507281783', '76561199386981826', '76561199227089062', '76561199509911358', '76561199472990101',
'76561199192150257', '76561199220629425', '76561199453781060', '76561199210455209', '76561199364229305',
'76561199511613148', '76561199507420508', '76561199213203805', '76561199566800840', '76561199744755858',
'76561199701744524', '76561199514390756', '76561199667701900', '76561199545422896',
'76561199744755858', '76561199747892947', '76561199729698848', '76561199545422896', '76561199566800840',
'76561199798892735', '76561199523079624', '76561199797310424', '76561199567353379', '76561199675184915',
'76561198376829135', '76561198386926570', '76561199223759358', '76561199351824048', '76561199681941103',
'76561199696284428', '76561199649518887', '76561199596481907', '76561199180338743', '76561199859384312',
'76561198155811728', '76561198131642648', '76561199443802924', '76561199544258926', '76561198249942374',
'76561198392494864', '76561198839728826', '76561198962749786', '76561198843600814', '76561198352974783',
'76561199592437801', '76561199570743351', '76561199727957401', '76561199569744536', '76561199248513528',
'76561199133669185', '76561198964370136', '76561199043792892',
'76561199742212953', '76561199384249227', '76561199364236014', '76561199511695528', '76561199507410413',
'76561199221133544', '76561199076999508', '76561199239570712', '76561199093646362', '76561199446661794',
'76561199140992806', '76561198079869692', '76561199228669966', '76561199507103817', '76561199510458228',
'76561199484376530', '76561199319905419', '76561199718427028', '76561199690562941', '76561199737363693',
'76561199543935896', '76561199712962309', '76561199507711258', '76561199526266956', '76561199689996718',
'76561199241416845', '76561199718427028', '76561199614455891', '76561199690562941', '76561199688802916',
'76561199765839486', '76561199767058596', '76561199801089217', '76561199563875260', '76561199404414716',
'76561199467323390', '76561199566903184', '76561199240063525', '76561199649243262', '76561199596108964',
'76561199596108964', '76561198041694479', '76561199174415554', '76561199360962076', '76561198980863448',
'76561199650884709', '76561198089686722', '76561199050104014', '76561199118161837', '76561199118870458',
'76561199049916037', '76561199118439760', '76561199501224076', '76561199198626685', '76561199487719387',
'76561199239448125', '76561198359299614', '76561198199228331', '76561198991936513', '76561199562965213',
'76561199680012174', '76561199707027385', '76561199562965213', '76561199443563484', '76561198995635644',
'76561199233254553', '76561199067051379', '76561199167281779', '76561198998986262', '76561199101414271',
'76561198867351549', '76561199075371343', '76561199075272006', '76561199507618841', '76561199566212225',
'76561199527543175', '76561199801044428', '76561199567531804', '76561199696415751',
'76561199140187953', '76561199545399041', '76561199702162559', '76561199310037380', '76561199507169363',
'76561199509887225', '76561199510851138','76561199673546113',
'76561199302385501', '76561199605136008', '76561199680773490',
'76561198835518367', '76561199504108535', '76561199467029172',
'76561199192146500','76561199566100691','76561199154555452','76561199232238579',
'76561199739471682', '76561198177518099', '76561198152164991',
'76561198316099005', '76561199153699291', '76561198428602113', '76561198851682743', '76561198962442004',
'76561199158513643', '76561199200722569', '76561199087530915', '76561198998336799', '76561199072980252',
'76561199042501924', '76561198982702684', '76561199130432162',
'76561199441598842', '76561199429208869', '76561199507071195', '76561199512360555', '76561199355814480',
'76561199411101472', '76561199401885071', '76561199274658372', '76561199267899723', '76561198164398573',
'76561199556576926', '76561199741595427', '76561199695653161', '76561199693902512', '76561199609399591',
'76561199633754533', '76561199548351838', '76561199769694358', '76561199745703756',
'76561199633754533', '76561199745703756', '76561199548351838', '76561199695653161', '76561199566756143',
'76561199693902512', '76561199609399591', '76561199556576926', '76561199575547886', '76561199569830148',
'76561199741595427', '76561199730414920', '76561199612593809', '76561199794294400', '76561199691840168',
'76561199226390061', '76561199111510750', '76561199043992578', '76561199163215334', '76561198316214356',
'76561198054013153', '76561198872598024', '76561198369794877', '76561199036162775', '76561198294247284',
'76561199589823074', '76561199731235035', '76561199750146422', '76561199604388314', '76561199697794898',
'76561199577315556', '76561199728241404', '76561199054603822',
'76561199052765228', '76561199084801539', '76561199014233742', '76561199041913550',
'76561199275679989', '76561199014233742', '76561199055593365', '76561198997682276', '76561199043782899',
'76561199058853128', '76561199074716626', '76561199227675061', '76561199183430682', '76561199039963196',
'76561199518029572', '76561199507265913', '76561199507686624', '76561199511731414', '76561199549340844',
'76561199744784785', '76561198181735917', '76561198243358794', '76561199507574015', '76561199480503022',
'76561199438001777', '76561199495055957', '76561199230002378', '76561199681416925', '76561199364564507',
'76561199406429950', '76561199641315402', '76561199554633753', '76561199531105087', '76561199627369933',
'76561199403011837', '76561199757115215', '76561199650289322', '76561199798866508', '76561199686210502',
'76561199549837249', '76561199549105881', '76561198883152807', '76561198262789010', '76561199719650650',
'76561198997740713', '76561199692887290', '76561199097831050', '76561199037709758', '76561199082919789',
'76561199149057307', '76561199614618964', '76561199049876792',
'76561199118886308', '76561198013547155', '76561199118796041', '76561199049995620', '76561199078524700',
'76561199521058194', '76561199506894148', '76561199403789575', '76561198382518822',
'76561198830807027', '76561199686597220', '76561199238947372', '76561199525196209', '76561199706773850',
'76561198996772569', '76561199077528514', '76561199323497804', '76561199074881032', '76561199075333639',
'76561199232331866', '76561198311585018', '76561199208284228', '76561199433227118',
'76561199558333091', '76561199548092103', '76561199170768162', '76561199083303181',
'76561199046331330', '76561199143350957', '76561199093729892', '76561199406269446',
'76561199186121245', '76561199227691961','76561199205193719',
'76561199569161430',
'76561199183343351', '76561199590722711', '76561199507200612', '76561199582889175', '76561199047042187',
'76561199445525515', '76561199545220637', '76561199569767133','76561199507381446','76561199195683959','76561199220921533',
'76561198083710085',

]


DATA_FILE = 'friend_data.json'
INIT_FILE = '.initialized'

# Optimized rate limiting configuration for speed
MAX_CONCURRENT_REQUESTS = 50  # High concurrency
REQUEST_DELAY = 0.1  # Very short delay between requests
BURST_SIZE = 100  # Allow bursts of requests
BURST_DELAY = 5  # Pause after each burst
MAX_RETRIES = 2  # Limit retries to keep speed up

logging.basicConfig(level=logging.INFO, format='%(asctime)s - %(levelname)s - %(message)s')
logger = logging.getLogger("SteamFriendIDMonitor")

class FastRateLimiter:
    def __init__(self, max_concurrent=50, burst_size=100, burst_delay=5):
        self.semaphore = asyncio.Semaphore(max_concurrent)
        self.burst_size = burst_size
        self.burst_delay = burst_delay
        self.request_count = 0
        self.last_burst_reset = None
        self.loop = None
    
    async def acquire(self):
        if self.loop is None:
            self.loop = asyncio.get_event_loop()
            self.last_burst_reset = self.loop.time()
        
        await self.semaphore.acquire()
        
        # Check if we need to pause after a burst
        self.request_count += 1
        if self.request_count >= self.burst_size:
            current_time = self.loop.time()
            time_since_reset = current_time - self.last_burst_reset
            
            if time_since_reset < self.burst_delay:
                sleep_time = self.burst_delay - time_since_reset
                logger.debug(f"Burst limit reached, sleeping for {sleep_time:.2f}s")
                await asyncio.sleep(sleep_time)
            
            self.request_count = 0
            self.last_burst_reset = self.loop.time()
        
        # Small delay to prevent hammering
        await asyncio.sleep(0.05 + random.uniform(0, 0.05))
    
    def release(self):
        self.semaphore.release()

# Rate limiter will be created inside the main function

def get_profile_link(steam_id):
    """Generate Steam profile link from Steam ID"""
    return f"steamcommunity.com/profiles/{steam_id}"

async def fetch_friend_list(session, steam_id, rate_limiter, retry_count=0):
    """Fetch the complete friend list for a Steam account with optimized rate limiting"""
    url = f"http://api.steampowered.com/ISteamUser/GetFriendList/v0001/?key={STEAM_API_KEY}&steamid={steam_id}&relationship=friend"
    profile_link = get_profile_link(steam_id)
    
    await rate_limiter.acquire()
    try:
        async with session.get(url, timeout=10) as resp:
            if resp.status == 200:
                data = await resp.json()
                friends_data = data.get('friendslist', {}).get('friends', [])
                friend_ids = [friend['steamid'] for friend in friends_data]
                return steam_id, profile_link, friend_ids
            elif resp.status == 403:
                logger.debug(f"{profile_link} is private")
                return steam_id, profile_link, None
            elif resp.status in [429, 420]:
                if retry_count < MAX_RETRIES:
                    # Exponential backoff for rate limits
                    delay = (2 ** retry_count) + random.uniform(0, 1)
                    logger.warning(f"{profile_link}: Rate limited, retrying in {delay:.2f}s")
                    await asyncio.sleep(delay)
                    return await fetch_friend_list(session, steam_id, rate_limiter, retry_count + 1)
                else:
                    logger.error(f"{profile_link}: Max retries exceeded for rate limit")
                    return steam_id, profile_link, None
            else:
                logger.warning(f"{profile_link}: API error {resp.status}")
                return steam_id, profile_link, None
    except asyncio.TimeoutError:
        logger.warning(f"Timeout fetching {profile_link}")
        return steam_id, profile_link, None
    except Exception as e:
        logger.warning(f"Error fetching {profile_link}: {e}")
        return steam_id, profile_link, None
    finally:
        rate_limiter.release()

async def send_telegram_message(message):
    """Send message to Telegram, splitting if too long"""
    MAX_MESSAGE_LENGTH = 4000
    
    if len(message) <= MAX_MESSAGE_LENGTH:
        await _send_single_message(message)
    else:
        lines = message.split('\n')
        current_chunk = ""
        
        for line in lines:
            if len(current_chunk + line + '\n') > MAX_MESSAGE_LENGTH:
                if current_chunk:
                    await _send_single_message(current_chunk.strip())
                    current_chunk = line + '\n'
                else:
                    await _send_single_message(line[:MAX_MESSAGE_LENGTH])
            else:
                current_chunk += line + '\n'
        
        if current_chunk:
            await _send_single_message(current_chunk.strip())

async def _send_single_message(message):
    """Send a single message to Telegram"""
    url = f"https://api.telegram.org/bot{TELEGRAM_BOT_TOKEN}/sendMessage"
    payload = {
        'chat_id': TELEGRAM_CHAT_ID,
        'text': message,
        'parse_mode': 'HTML'
    }
    async with aiohttp.ClientSession() as session:
        try:
            async with session.post(url, data=payload) as resp:
                if resp.status != 200:
                    logger.error(f"Failed to send message: {await resp.text()}")
                else:
                    logger.info("Telegram message sent successfully")
        except Exception as e:
            logger.error(f"Telegram error: {e}")

def load_previous_data():
    """Load previous friend data from file"""
    try:
        with open(DATA_FILE, 'r') as f:
            return json.load(f)
    except:
        return {}

def save_data(data):
    """Save friend data to file"""
    with open(DATA_FILE, 'w') as f:
        json.dump(data, f, indent=2)

def is_first_run():
    """Check if this is the first run of the bot"""
    if os.path.exists(INIT_FILE):
        return False
    with open(INIT_FILE, 'w') as f:
        f.write(datetime.now().isoformat())
    return True

async def check_accounts():
    """Main function to check all accounts for friend changes - optimized for speed"""
    start_time = time.time()
    first_run = is_first_run()
    previous_data = load_previous_data()
    current_data = {}
    all_new_friends = []
    
    # Create rate limiter inside the async function
    rate_limiter = FastRateLimiter(MAX_CONCURRENT_REQUESTS, BURST_SIZE, BURST_DELAY)
    
    logger.info(f"Starting fast check for {len(STEAM_ACCOUNTS)} accounts...")
    
    # Optimized session configuration for high throughput
    connector = aiohttp.TCPConnector(
        limit=200,  # High connection pool
        limit_per_host=100,  # High per-host limit
        ttl_dns_cache=300,  # DNS cache
        use_dns_cache=True,
        keepalive_timeout=30,
        enable_cleanup_closed=True
    )
    
    timeout = aiohttp.ClientTimeout(total=15, connect=5)
    
    async with aiohttp.ClientSession(
        connector=connector, 
        timeout=timeout,
        headers={'User-Agent': 'SteamFriendMonitor/1.0'}
    ) as session:
        
        # Create all tasks at once for maximum concurrency
        tasks = [fetch_friend_list(session, steam_id, rate_limiter) for steam_id in STEAM_ACCOUNTS]
        
        # Progress tracking
        completed = 0
        total = len(tasks)
        
        # Process all requests concurrently with progress updates
        for coro in asyncio.as_completed(tasks):
            try:
                steam_id, profile_link, friend_ids = await coro
                completed += 1
                
                # Progress update every 500 accounts
                if completed % 500 == 0 or completed == total:
                    elapsed = time.time() - start_time
                    rate = completed / elapsed
                    eta = (total - completed) / rate if rate > 0 else 0
                    logger.info(f"Progress: {completed}/{total} ({completed/total*100:.1f}%) - {rate:.1f} req/s - ETA: {eta:.1f}s")
                
                if friend_ids is None:
                    continue
                    
                current_data[steam_id] = {
                    'profile_link': profile_link,
                    'friends': friend_ids,
                    'count': len(friend_ids)
                }
                
                # Skip change detection on first run
                if first_run or steam_id not in previous_data:
                    continue
                    
                previous_friends = set(previous_data[steam_id].get('friends', []))
                current_friends = set(friend_ids)
                
                # Check for new friends only
                new_friends = current_friends - previous_friends
                if new_friends:
                    for friend_id in new_friends:
                        friend_profile_link = get_profile_link(friend_id)
                        all_new_friends.append(friend_profile_link)
                        logger.info(f"New friend detected: {friend_id} added to {steam_id}")
                
                # Log removed friends (no telegram notification)
                removed_friends = previous_friends - current_friends
                if removed_friends:
                    for friend_id in removed_friends:
                        logger.debug(f"Friend removed: {friend_id} removed from {steam_id}")
                        
            except Exception as e:
                logger.error(f"Error processing task: {e}")
                completed += 1

    total_time = time.time() - start_time
    successful_accounts = len(current_data)
    avg_rate = successful_accounts / total_time if total_time > 0 else 0
    
    logger.info(f"Completed in {total_time:.2f}s - {avg_rate:.1f} accounts/sec - {successful_accounts}/{len(STEAM_ACCOUNTS)} successful")

    # Send batched notification for all new friends
    logger.info(f"Total new friends collected: {len(all_new_friends)}")
    
    if all_new_friends and not first_run:
        if len(all_new_friends) == 1:
            msg = f"New friend: {all_new_friends[0]}"
        else:
            msg = f"New friends detected ({len(all_new_friends)}):\n\n"
            msg += "\n".join([f"• {friend_link}" for friend_link in all_new_friends])
        
        logger.info(f"Sending Telegram notification for {len(all_new_friends)} new friends")
        await send_telegram_message(msg)
    elif all_new_friends and first_run:
        logger.info(f"New friends detected on first run (not sending notification): {len(all_new_friends)}")
    else:
        logger.info("No new friends detected in this cycle")

    # Save current data
    save_data(current_data)

    if first_run:
        total_accounts = len(current_data)
        private_accounts = len(STEAM_ACCOUNTS) - total_accounts
        total_friends = sum(data['count'] for data in current_data.values())
        
        logger.info(f"Steam Friend ID Monitor Setup Complete")
        logger.info(f"Monitoring {total_accounts} accounts")
        logger.info(f"Total friends being tracked: {total_friends}")
        if private_accounts > 0:
            logger.info(f"{private_accounts} accounts are private")
        logger.info("Bot will now notify when specific friends are added with their Steam IDs")
    else:
        logger.info(f"Friend check completed. Successfully processed {successful_accounts} accounts in {total_time:.2f}s")

if __name__ == '__main__':
    asyncio.run(check_accounts())
