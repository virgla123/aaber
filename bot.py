import os
import json
import asyncio
import aiohttp
import logging
from datetime import datetime
import random
import time

# Configuration
TELEGRAM_BOT_TOKEN = os.environ.get('TELEGRAM_BOT_TOKEN', '')
TELEGRAM_CHAT_ID = os.environ.get('TELEGRAM_CHAT_ID', '')
STEAM_API_KEY = os.environ.get('STEAM_API_KEY', '')


STEAM_ACCOUNTS = [

'76561199643685093','76561199644693584','76561199644223807','76561199650579311','76561199651865287','76561199652113994',
'76561199651176898','76561199652298282','76561199652159664','76561199652147113','76561199650161968','76561199652292482',
'76561199644164348','76561199644122694','76561199652263420','76561199652212818','76561199652497421','76561199652242559',
'76561199652479749','76561199644884387','76561199652373851','76561199644479356','76561199644934744','76561199649794324',
'76561199652393645','76561199643283090','76561199644091932','76561199643629101','76561199644493633','76561199644041004',
'76561199652555555','76561199644828214','76561199643213156','76561199653009064','76561199643740896','76561199652037075',
'76561199651967731','76561199652714652','76561199652292963','76561199651977591','76561199652609325','76561199651644242',
'76561199645340303','76561199644024511','76561199649511100','76561199644009554','76561199644733254','76561199652592602',
'76561199651972169','76561199652633505','76561199651849063','76561199644053129','76561199652292939','76561199651475691',
'76561199644616797','76561199644321724','76561199644362472','76561199652033300','76561199643827766','76561199644599109',
'76561199651014626','76561199651687830','76561199652635592','76561199644429942','76561199651521679','76561199652270739',
'76561199652034690','76561199651650260','76561199643711954','76561199651379867','76561199649829615','76561199643678663',
'76561199651743190','76561199652292214','76561199652944252','76561199651598618','76561199652094172','76561199651820048',
'76561199652226421','76561199644943972','76561199651425346','76561199651892927','76561199644182797','76561199651505431',
'76561199652482230','76561199652214154','76561199652503742','76561199649553709','76561199651986859','76561199651786964',
'76561199652349715','76561199644732197','76561199653031731','76561199651858191','76561199652714367','76561199643864723',
'76561199645081486','76561199651574891','76561199652116271','76561199652331735','76561199652206342','76561199652205416',
'76561199652474786','76561199650359026','76561199651965503','76561199651755143','76561199651984890','76561199652242370',
'76561199652502087','76561199651902113','76561199651772952','76561199652116569','76561199644433046','76561199650220773',
'76561199643535486','76561199651771329','76561199644019909','76561199644048106','76561199644939378','76561199643741327',
'76561199651710126','76561199644367268','76561199652624404','76561199643796440','76561199644430222','76561199644727253',
'76561199651760126','76561199651635323','76561199652062042','76561199651676522','76561199651213209','76561199652649321',
'76561199652659039','76561199644250598','76561199652963537','76561199651803227','76561199652209468','76561199645195663',
'76561199643845193','76561199651841151','76561199644879753','76561199650518792','76561199652541531','76561199651868142',
'76561199644987500','76561199651566298','76561199651863498','76561199644039880','76561199643858554','76561199649905516',
'76561199651727828','76561199644564937','76561199652048800','76561199650507038','76561199644219571','76561199653318975',
'76561199643502217','76561199649901193','76561199651646654','76561199652462865','76561199652752188','76561199649822094',
'76561199651853821','76561199652771194','76561199652106825','76561199651629157','76561199652539290','76561199649623201',
'76561199652032394','76561199644227260','76561199652508523','76561199652389551','76561199651939621','76561199644280413',
'76561199643722854','76561199652729771','76561199643737599','76561199651714889','76561199644564480','76561199644140610',
'76561199644372402','76561199651738505','76561199650678452','76561199652287194','76561199644266069','76561199644098924',
'76561199651235643','76561199650062090','76561199651330068','76561199651897457','76561199644884425','76561199650335559',
'76561199643856763','76561199643347196','76561199652326707','76561199643989035','76561199652370526','76561199652601116',
'76561199643886256','76561199643978956','76561199650031096','76561199644168282','76561199652019531','76561199644134645',
'76561199652156813','76561199651756018','76561199643388278','76561199644725224','76561199644181082','76561199652337346',
'76561199652047618','76561199652747062','76561199644159913','76561199651968493','76561199644169728','76561199652264441',
'76561199652330442','76561199651426639','76561199652188317','76561199644775290','76561199644747448','76561199651036030',
'76561199643922281','76561199644197947','76561199643618987','76561199644333919','76561199644764800','76561199643598089',
'76561199652578520','76561199652006468','76561199651581677','76561199644680223','76561199652218940','76561199651988874',
'76561199643772535','76561199644733749','76561199652309717','76561199644917213','76561199651786113','76561199644367588',
'76561199644263795','76561199652043602','76561199643675815','76561199649852490','76561199644473099','76561199652237806',
'76561199644429652','76561199652661631','76561199651897791','76561199651291975','76561199651903562','76561199644874451',
'76561199644892735','76561199651995649','76561199651281679','76561199652135708','76561199651976789','76561199652350542',
'76561199651324110','76561199650548051','76561199652423288','76561199649000994','76561199651413054','76561199644095271',
'76561199652026597','76561199652675004','76561199651730737','76561199652492641','76561199644176332','76561199644462648',
'76561199644365513','76561199644350477','76561199651881286','76561199644238007','76561199652110016','76561199652069070',
'76561199644474793','76561199643833113','76561199652730349','76561199652002197','76561199644336564','76561199652089747',
'76561199642933721','76561199650228234','76561199652090905','76561199644015294','76561199652117822','76561199644709685',
'76561199652456088','76561199652114225','76561199644414630','76561199651619593','76561199652392542','76561199644004926',
'76561199651990654','76561199651610928','76561199652136426','76561199652145624','76561199651589988','76561199644541207',
'76561199652504551','76561199650508058','76561199652552661','76561199652346995','76561199651905614','76561199653519972',
'76561199649704910','76561199643245718','76561199651882999','76561199644439389','76561199651865905','76561199652870634',
'76561199651946895','76561199651938275','76561199652455986','76561199651724470','76561199652993337','76561199644301107',
'76561199650292711','76561199644067351','76561199652564672','76561199645038339','76561199652623194','76561199651204954',
'76561199649889616','76561199644139014','76561199644290874','76561199643552644','76561199644794385','76561199645088577',
'76561199644350672','76561199643581656','76561199651895499','76561199652991629','76561199643462338','76561199652138720',
'76561199644608067','76561199652607334','76561199652728273','76561199652271568','76561199644229772','76561199643863800',
'76561199652535243','76561199651140723','76561199652473497','76561199652318054','76561199644907213','76561199644425811',
'76561199644032084','76561199644682322','76561199643282271','76561199644948544','76561199643911455','76561199644025845',
'76561199645168795','76561199644939512','76561199652069984','76561199643724042','76561199652338145','76561199651978316',
'76561199644317663','76561199651549389','76561199644291320','76561199652052075','76561199643887862','76561199652461773',
'76561199652241489','76561199651746386','76561199650570393','76561199652211090','76561199644598845','76561199651954844',
'76561199644109650','76561199643437661','76561199650026475','76561199651876587','76561199651946205','76561199644233776',
'76561199644960880','76561199644386745','76561199651986089','76561199643587326','76561199650191638','76561199644009716',
'76561199652255133','76561199652125773','76561199644026659','76561199652417388','76561199652063190','76561199644584055',
'76561199652474122','76561199644266923','76561199652401231','76561199644860252','76561199652202891','76561199652739495',
'76561199649649510','76561199652478659','76561199644340551','76561199652470084','76561199644141689','76561199651212432',
'76561199644393272','76561199653112724','76561199652368153','76561199644767681','76561199649701533','76561199652767270',
'76561199652449273','76561199651105468','76561199644622223','76561199651672021','76561199652369805','76561199644686423',
'76561199649966423','76561199643947828','76561199651599186','76561199651208294','76561199651505286','76561199652452705',
'76561199643779273','76561199651799731','76561199651089039','76561199651438166','76561199644785836','76561199644629019',
'76561199653158819','76561199652354868','76561199652478849','76561199650228532','76561199652587044','76561199651163347',
'76561199645039815','76561199644267551','76561199643971591','76561199651898754','76561199644443153','76561199652470953',
'76561199652581863','76561199651499272','76561199653068171','76561199652176460','76561199652849359','76561199652673779',
'76561199651007537','76561199644759259','76561199651643795','76561199651766047','76561199643886367','76561199651651789',
'76561199652105582','76561199652223208','76561199644492612','76561199652344918','76561199650367705','76561199651824141',
'76561199652073995','76561199645011171','76561199644548713','76561199652944506','76561199651940546','76561199643286861',
'76561199643711388','76561199652319764','76561199643789967','76561199652468307','76561199643440948','76561199643643327',
'76561199644261455','76561199651947119','76561199653254832','76561199650486995','76561199652283359','76561199644292367',
'76561199644516730','76561199644657827','76561199651799336','76561199644065192','76561199644318220','76561199651701344',
'76561199644395754','76561199652725489','76561199651899032','76561199645280310','76561199652450872','76561199652029258',
'76561199649998657','76561199651725792','76561199651959743','76561199643427616','76561199651914356','76561199643934779',
'76561199651105050','76561199652184494','76561199643682118','76561199651975619','76561199644131077','76561199652176586',
'76561199643972462','76561199651450210','76561199651921900','76561199644567242','76561199653052457','76561199644995159',
'76561199652248197','76561199643663267','76561199652026090','76561199652170881','76561199652993353','76561199645129590',
'76561199652138261','76561199644391293','76561199643894845','76561199644264095','76561199644204465','76561199643843518',
'76561199643806883','76561199652998788','76561199652477410','76561199644326237','76561199644505874','76561199652012681',
'76561199644170281','76561199644587279','76561199649700640','76561199642984300','76561199651954409','76561199644231692',
'76561199652138343','76561199652224867','76561199652031690','76561199651656163','76561199652352690','76561199644243639',
'76561199651378175','76561199644560839','76561199652127976','76561199643406788','76561199652268170','76561199652899590',
'76561199644019611','76561199651046830','76561199651940903','76561199652765444','76561199644374109','76561199652708846',
'76561199652952619','76561199644104850','76561199652018030','76561199652341178','76561199643703310','76561199644396817',
'76561199652104643','76561199652679569','76561199652880401','76561199652912007','76561199643002362','76561199651680001',
'76561199651143472','76561199649480593','76561199651309800','76561199652605137','76561199644706561','76561199652605993',
'76561199652702349','76561199652832030','76561199652351062','76561199652812296','76561199651760860','76561199643898163',
'76561199652041509','76561199650659872','76561199650548104','76561199644068867','76561199652552412','76561199644189889',
'76561199652461220','76561199651511351','76561199643070460','76561199644033832','76561199652502594','76561199652494690',
'76561199651674199','76561199649914566','76561199652596860','76561199652727282','76561199651764452','76561199651931596',
'76561199644127381','76561199643805777','76561199643792144','76561199644569965','76561199643670767','76561199652456721',
'76561199643766248','76561199652193798','76561199644695839','76561199652325038','76561199651166008','76561199652652303',
'76561199651593773','76561199652188210','76561199652446045','76561199651545543','76561199651871807','76561199651996467',
'76561199651928186','76561199652575513','76561199651519743','76561199651610863','76561199644981454','76561199652067573',
'76561199651623862','76561199652534792','76561199652605913','76561199652619067','76561199644699088','76561199651908074',
'76561199652356303','76561199644825772','76561199643970472','76561199644460354','76561199644263366','76561199644725159',
'76561199644738231','76561199651905635','76561199651540502','76561199650204505','76561199643763160','76561199644341433',
'76561199644864730','76561199644406776','76561199643890288','76561199644373685','76561199643581664','76561199652536828',
'76561199649586175','76561199644160210','76561199651976573','76561199644434755','76561199644263619','76561199644109603',
'76561199652171950','76561199651927872','76561199644503586','76561199643638749','76561199644884125','76561199652306870',
'76561199651933574','76561199644000675','76561199652374398','76561199649285419','76561199652107741','76561199644565962',
'76561199645036011','76561199644450038','76561199651435838','76561199652003187','76561199643431324','76561199652285600',
'76561199652128069','76561199644097545','76561199652088037','76561199652825419','76561199643642263','76561199652623747',
'76561199644079087','76561199649669100','76561199651571183','76561199651690486','76561199644019458','76561199644420903',
'76561199644510692','76561199652062485','76561199652190624','76561199644271459','76561199652039630','76561199643534049',
'76561199650284270','76561199651779726','76561199644283341','76561199644369771','76561199643653672','76561199652499994',
'76561199652003558','76561199652062116','76561199652178620','76561199652585100','76561199651897374','76561199652302343',
'76561199652406607','76561199642920360','76561199651809351','76561199644895620','76561199644253338','76561199651598859',
'76561199643686657','76561199652769810','76561199644856110','76561199644704956','76561199644305920','76561199644231336',
'76561199644927918','76561199651906204','76561199652050723','76561199652451776','76561199644548120','76561199651816711',
'76561199652165079','76561199651914034','76561199652299887','76561199651694835','76561199652113330','76561199643867194',
'76561199643831447','76561199644433384','76561199644738049','76561199653069071','76561199651972320','76561199643444650',
'76561199651963806','76561199649593917','76561199652830509','76561199652143140','76561199651918469','76561199643905365',
'76561199643342395','76561199643597640','76561199643771305','76561199649751909','76561199643578609','76561199651587607',
'76561199650070659','76561199644278367','76561199652190577','76561199650207440','76561199651801962','76561199652220191',
'76561199652258767','76561199651575978','76561199644670464','76561199652043149','76561199653179678','76561199644357546',
'76561199652361089','76561199644551591','76561199644030733','76561199651599576','76561199652590190','76561199652492949',
'76561199651935917','76561199645034718','76561199644847853','76561199644367906','76561199652118054','76561199644161839',
'76561199650542412','76561199644438317','76561199643902024','76561199652041536','76561199644224871','76561199652529948',
'76561199644947519','76561199652383569','76561199652326753','76561199643874120','76561199644971224','76561199645093817',
'76561199652204480','76561199651467510','76561199643739131','76561199644725215','76561199651707151','76561199644522840',
'76561199651886243','76561199651835752','76561199651973193','76561199652366692','76561199652713378','76561199644886392',
'76561199652858451','76561199651865406','76561199643735792','76561199644220658','76561199651909122','76561199653401017',
'76561199644571898','76561199652062088','76561199650009416','76561199644129137','76561199643944380','76561199644945977',
'76561199650234284','76561199652929858','76561199649987985','76561199651821118','76561199644357671','76561199652116236',
'76561199652077417','76561199644779066','76561199651631284','76561199645188812','76561199644425616','76561199652113631',
'76561199644025391','76561199644616458','76561199644797475','76561199643978160','76561199651836746','76561199645141348',
'76561199652527816','76561199651505668','76561199644900684','76561199644404614','76561199644086598','76561199653179960',
'76561199651923136','76561199651575697','76561199644052239','76561199652170855','76561199644362890','76561199652384377',
'76561199652184566','76561199651606729','76561199652143748','76561199644639389','76561199652227232','76561199643944635',
'76561199644702437','76561199644519997','76561199651865461','76561199652260511','76561199652201075','76561199651757726',
'76561199645070744','76561199644209231','76561199652827856','76561199651953762','76561199651276135','76561199651676243',
'76561199651750693','76561199644715819','76561199644217829','76561199652858450','76561199644608015','76561199644106950',
'76561199643642896','76561199652444185','76561199651574685','76561199652632275','76561199643975896','76561199652416718',
'76561199651653153','76561199651862211','76561199652183648','76561199652875786','76561199644419832','76561199650078181',
'76561199652643958','76561199652794626','76561199651595359','76561199644270552','76561199650053419','76561199644219365',
'76561199651792615','76561199644410773','76561199651177351','76561199652223084','76561199643927472','76561199644588265',
'76561199643977676','76561199651880838','76561199652213755','76561199651954260','76561199652227780','76561199643931511',
'76561199644639111','76561199652127823','76561199652537325','76561199643711283','76561199651820167','76561199651261150',
'76561199652181029','76561199644110787','76561199652362309','76561199651472287','76561199644775778','76561199652315288',
'76561199644234610','76561199644698745','76561199642921653','76561199644334846','76561199644117508','76561199652334588',
'76561199644659609','76561199644215772','76561199651962101','76561199644574783','76561199652884779','76561199643691886',
'76561199644416696','76561199644492453','76561199644758926','76561199643382328','76561199644092568','76561199651497466',
'76561199652142630','76561199652074816','76561199651839427','76561199644121641','76561199652460262','76561199652021560',
'76561199653144316','76561199643980116','76561199643690266','76561199651576352','76561199652088601','76561199651604622',
'76561199652083835','76561199643772746','76561199651784097','76561199651900065','76561199652879906','76561199643681485',
'76561199650931993','76561199651472577','76561199652140575','76561199651857679','76561199649821947','76561199652590027',
'76561199649591389','76561199651840338','76561199651269496','76561199643833908','76561199645447774','76561199652099802',
'76561199644626954','76561199652843236','76561199651741584','76561199651690643','76561199652195593','76561199644612130',
'76561199651967192','76561199644048979','76561199651536626','76561199644628979','76561199651534807','76561199651351989',
'76561199651428135','76561199643739671','76561199651907150','76561199651769720','76561199644336167','76561199644559488',
'76561199652943826','76561199651717486','76561199644307451','76561199644892191','76561199644962059','76561199652336046',
'76561199644631974','76561199651823673','76561199652412475','76561199652130437','76561199652591690','76561199651938395',
'76561199643396965','76561199652662418','76561199652000163','76561199652394507',

'76561199528241293','76561199527989013','76561199527526226','76561199528025729','76561199527445830','76561199528233764',
'76561199528348568','76561199527244795','76561199528123813','76561199527650873','76561199527117735','76561199526855375',
'76561199527831102','76561199528755164','76561199527448467','76561199527859408','76561199527496228','76561199527673409',
'76561199527829141','76561199528073082','76561199527840880','76561199527167876','76561199528355895','76561199527482028',
'76561199527553826','76561199527363469','76561199527193601','76561199527234286','76561199526945576','76561199527704890',
'76561199527216231','76561199527568453','76561199528129994','76561199527117069','76561199527379489','76561199527139042',
'76561199527367090','76561199528322369','76561199526722481','76561199527164942','76561199528120525','76561199527629968',
'76561199528536041','76561199527352001','76561199527869192','76561199528295847','76561199526995781','76561199527847532',
'76561199527648811','76561199528681711','76561199527913827','76561199527008783','76561199527871874','76561199527730639',
'76561199527713382','76561199526959243','76561199527782125','76561199527643446','76561199526999542','76561199528655960',
'76561199528015281','76561199528324959','76561199527028772','76561199527725649','76561199528063196','76561199527474566',
'76561199527928118','76561199528222101','76561199527340198','76561199528109631','76561199528311487','76561199527853071',
'76561199528151250','76561199527668410','76561199527524239','76561199528358396','76561199528694615','76561199527909702',
'76561199527616681','76561199527326340','76561199527397891','76561199528255091','76561199528138113','76561199526845244',
'76561199527174227','76561199526658022','76561199527779265','76561199527957532','76561199527768196','76561199527720996',
'76561199527505209','76561199527971176','76561199526998319','76561199528284138','76561199528118407','76561199527957880',
'76561199528155255','76561199527835405','76561199528121658','76561199527521862','76561199527476105','76561199527640941',
'76561199528294788','76561199526741132','76561199527447288','76561199527752602','76561199528171589','76561199527843464',
'76561199528129857','76561199527929088','76561199527378777','76561199528047625','76561199527811521','76561199527797450',
'76561199527748091','76561199527843469','76561199528019760','76561199527726938','76561199527650383','76561199527684897',
'76561199528008507','76561199527184255','76561199527056501','76561199527664420','76561199528001159','76561199527751599',
'76561199527792554','76561199527662095','76561199528026956','76561199527807069','76561199527327910','76561199526857534',
'76561199527073535','76561199527498670','76561199528727328','76561199527718806','76561199527682582','76561199528121146',
'76561199528184766','76561199527954840','76561199527689565','76561199528053394','76561199527848195','76561199527751742',
'76561199528223601','76561199527546534','76561199528347538','76561199527086029','76561199527865610','76561199527514203',
'76561199527500583','76561199527986808','76561199527795848','76561199527835432','76561199528042403','76561199527310335',
'76561199527904266','76561199527825856','76561199527490405','76561199527873381','76561199527854833','76561199527484035',
'76561199526731244','76561199527504718','76561199528621555','76561199527756090','76561199528013282','76561199527836664',
'76561199527925391','76561199527657799','76561199527106374','76561199528279007','76561199528012120','76561199527955769',
'76561199527332826','76561199527995800','76561199528127793','76561199527171178','76561199527942328','76561199527096752',
'76561199527160314','76561199528040541','76561199527660859','76561199527834107','76561199527954724','76561199527923123',
'76561199527117887','76561199528718098','76561199527932048','76561199527799937','76561199527775954','76561199528708186',
'76561199528091205','76561199527510539','76561199527780173','76561199526959298','76561199527623196','76561199527848279',
'76561199528219679','76561199526886360','76561199527703970','76561199527872955','76561199527238498','76561199527937445',
'76561199527637896','76561199527593717','76561199527104983','76561199528091038','76561199528161097','76561199527674288',
'76561199527455523','76561199527996655','76561199527644850','76561199527370960','76561199527628120','76561199528100080',
'76561199527861884','76561199528507154','76561199528364084','76561199527907283','76561199527889599','76561199527390955',
'76561199527571540','76561199527259880','76561199527439640','76561199527228519','76561199527645995','76561199527148765',
'76561199527942619','76561199527492304','76561199526971631','76561199527611036','76561199528121934','76561199527487800',
'76561199527847622','76561199528075215','76561199527885235','76561199527876539','76561199527658986','76561199527425563',
'76561199527940269','76561199526991678','76561199527872626','76561199527329321','76561199526689078','76561199527861945',
'76561199527484786','76561199527573827','76561199527824371','76561199527913028','76561199527421154','76561199527965104',
'76561199528401560','76561199527856730','76561199527872805','76561199528013870','76561199527425622','76561199527098345',
'76561199527102411','76561199526902565','76561199528181909','76561199527574171','76561199528077294','76561199527804632',
'76561199527736274','76561199527222188','76561199527714277','76561199527511010','76561199527688166','76561199528092786',
'76561199527697805','76561199528026191','76561199527751379','76561199527873351','76561199527917068','76561199528045600',
'76561199528290591','76561199527774971','76561199527487047','76561199527627299','76561199527756183','76561199527329360',
'76561199527164293','76561199527138723','76561199527522628','76561199527324149','76561199527747386','76561199527998649',
'76561199527434356','76561199527823199','76561199526710887','76561199527366429','76561199527691100','76561199527043857',
'76561199527910347','76561199527553848','76561199526846839','76561199527286303','76561199528147453',

    '76561198991296575','76561198991068767','76561198991377201','76561198990952838','76561198991203789','76561198991461281',
'76561198991248135','76561198990969521','76561198991127592','76561198991795252','76561198991279799','76561198991300503',
'76561198991161919','76561198991040871','76561198991397713','76561198991379863','76561198991552866','76561198990863874',
'76561198991242607','76561198991294475','76561198991712315','76561198991402939','76561198991198681','76561198991584835',
'76561198991035543','76561198991547255','76561198991057972','76561198991226872','76561198991027278','76561198990985872',
'76561198991281956','76561198990808354','76561198991098685','76561198991474357','76561198991470762','76561198991320182',
'76561198991550984','76561198991308274','76561198991116394','76561198991167652','76561198991183088','76561198991317706',
'76561198991146081','76561198991250364','76561198991003409','76561198991103392','76561198991624128','76561198990802707',
'76561198990906165','76561198991063842','76561198991203116','76561198991322928','76561198991436515','76561198991160868',
'76561198991250852','76561198991144111','76561198990897248','76561198991024363','76561198991314502','76561198991390080',
'76561198991453348','76561198991150418','76561198991189775','76561198991181796','76561198991166056','76561198991081546',
'76561198991138122','76561198991318743','76561198991231844','76561198991043038','76561198991269286','76561198990799106',
'76561198991398395','76561198990903503','76561198991390127','76561198991848779','76561198991072866','76561198991646164',
'76561198991063417','76561198991270143','76561198991760204','76561198991279720','76561198991114013','76561198991483451',
'76561198991337419','76561198991647959','76561198991008444','76561198991568783','76561198991633394','76561198991327656',
'76561198991043410','76561198991028845','76561198991243167','76561198991287313','76561198991237571','76561198991137664',
'76561198991094902','76561198991176934','76561198991337306','76561198991040455','76561198991326623','76561198991220788',
'76561198991250698','76561198991221576','76561198991093149','76561198991125031','76561198991552133','76561198991283532',
'76561198991338025','76561198990428868','76561198991258589','76561198991155832','76561198990842663','76561198991044956',
'76561198991393379','76561198991359244','76561198990891257','76561198991160314','76561199404795959','76561198991332262',
'76561198991343365','76561198991779023','76561198991524144','76561198991176320','76561198991699197','76561198990922122',
'76561198991144153','76561198990998261','76561198991083050','76561198991158944','76561198991011263','76561198991026816',
'76561198991357094','76561198991460124','76561198991062207','76561198991215745','76561198992047093','76561198991052969',
'76561198991305685','76561198991342338','76561198991305609','76561198991646383','76561198990984514','76561198991336718',
'76561198991272168','76561198991244602','76561198991228786','76561198991156468','76561198991660858','76561198991422981',
'76561198991188094','76561198990834369','76561198991595593','76561198991259301','76561198991588536','76561198991170863',
'76561198991232191','76561198991037522','76561198991169032','76561198991159989','76561198991200030','76561198990960934',
'76561198990980553','76561198991000513','76561198991108300','76561198990933351','76561198991144823','76561198991504802',
'76561198991435727','76561198990966654','76561198991266226','76561198991349177','76561198991210077','76561198991383529',
'76561198990993362','76561198991106928','76561198991246142','76561198991342372','76561198991174538','76561198991031765',
'76561198991488742','76561198990866041','76561198991324004','76561198990803440','76561198991274933','76561198991226757',
'76561198990863261','76561198991870843','76561198991296229','76561198991246321','76561198991519874','76561198990949828',
'76561198991398704','76561198991142923','76561198991304544','76561198990962426','76561198991180876','76561198991064138',
'76561198990806975','76561198990796403','76561198991584874','76561198991246769','76561198991538330','76561198991156994',
'76561198991141150','76561198991351373','76561198991001607','76561198991368490','76561198991472491','76561198991089001',
'76561198991375838','76561198991043804','76561198991572274','76561198991061971','76561198991000954','76561198991016654',
'76561198991738017','76561198991163026','76561198991089386','76561198991369534','76561198991192312','76561198990947361',
'76561198991161107','76561198991328346','76561198991352550','76561198991149053','76561198991102231','76561198991531435',
'76561198991441814','76561198991072537','76561198991047376','76561198991519024','76561198991162727','76561198991373580',
'76561198991357490','76561198991090253','76561198991153283','76561198991348585','76561198991082586','76561198991254302',
'76561198991132260','76561198991285052','76561198990850101','76561198991596772','76561198991004591','76561198991270734',
'76561198991536951','76561198991324307','76561198991219850','76561198991003380','76561198991353417','76561198991133079',
'76561198991518836','76561198991137652','76561198990896805','76561198991060549','76561198991776659','76561198990854593',
'76561198991553058','76561198990964336','76561198990978474','76561198991430412','76561198991085006','76561198990823751',
'76561198991509962','76561198990824882','76561198991083122','76561198990950080','76561198991285305','76561198991559604',
'76561198991453623','76561198991272786','76561198991190096','76561198991467689','76561198991479964','76561198991278512',
'76561198991042071','76561198991026028','76561198991013042','76561198991546187','76561198991269969','76561198990922910',
'76561198991241314','76561198991648870','76561198990850952','76561198991401191','76561198991062463','76561198991156620',
'76561198991336243','76561198991606947','76561198991623935','76561198991758698','76561198990983529','76561198991295248',
'76561198991175161','76561198991148172','76561198991700731','76561198991705478','76561198991078973','76561198991366512',
'76561198991181630','76561198991327043','76561198991545088','76561198991140962','76561198990990597','76561198991102933',
'76561198991177706','76561198991395578','76561198991093346','76561198991441592','76561198991021307','76561198991085722',
'76561198990847143','76561198991226836','76561198991526078','76561198991154552','76561198991148611','76561198991058802',
'76561198991195303','76561198991547937','76561198990911287','76561198990993271','76561198991156736','76561198991354299',
'76561198991250860','76561198991298739','76561198991333505','76561198991295365','76561198991166163','76561198991228801',
'76561198991216382','76561198991038045','76561198991506759','76561198991177659','76561198991290910','76561198991360421',
'76561198991154650','76561198991518233','76561198991178106',

    '76561198005496993','76561198004909613','76561198005901886','76561198008244438','76561198005737632','76561198009128906',
'76561198009540178','76561198012000667','76561198012303988','76561198014038692','76561198014920098','76561198017158006',
'76561198017571997','76561198018612422','76561199176065950','76561199180284068','76561199182986556','76561199192557547',
'76561199277499283','76561199373389203','76561199487745240','76561199487906778','76561199487976369','76561199488106889',
'76561199488616610','76561199488843297','76561199488855680','76561199488926170','76561199488963692','76561199489120301',
'76561199489459972','76561199489467320','76561199489575644','76561199489765233','76561199489843444','76561199489864936',
'76561199489922840','76561199495635521','76561199495835405','76561199496087758','76561199496315870','76561199496333180',
'76561199496555733','76561199496629890','76561199496639731','76561199496660782','76561199496881408','76561199496905945',
'76561199497001587','76561199497121095','76561199497135449','76561199572911787','76561199573092304','76561199573206957',
'76561199573213824','76561199573227265','76561199573234703','76561199573294612','76561199573347957','76561199573367047',
'76561199573378684','76561199573399730','76561199573432211','76561199573440052','76561199573441808','76561199573448459',
'76561199573473736','76561199573504620','76561199573505995','76561199573515673','76561199573566423','76561199573569054',
'76561199573624516','76561199573651659','76561199573656318','76561199573721428','76561199573734788','76561199573751034',
'76561199573772806','76561199573790149','76561199573802128','76561199573830863','76561199573842292','76561199573875522',
'76561199573942169','76561199573971867','76561199573986542','76561199573994571','76561199574157532','76561199574169839',
'76561199835585176','76561199836167617','76561199836199916','76561199836247806','76561199836326724','76561199836369890',
'76561199836463893','76561199836515436','76561199836923555','76561199837082486','76561199837549498','76561198005256071',
'76561198006226257','76561198007158768','76561198007845771','76561198009152296','76561198010014395','76561198010235205',
'76561198011064397','76561198011220191','76561198011764632','76561198011944645','76561198012057834','76561198014280215',
'76561198017644191','76561199038044620','76561199106577061','76561199181458603','76561199213283513','76561199269595074',
'76561199271814498','76561199310382195','76561199343768581','76561199486708156','76561199486755601','76561199487098175',
'76561199487125232','76561199487431165','76561199487510751','76561199487636490','76561199487650377','76561199487910081',
'76561199488075492','76561199488183214','76561199488810816','76561199489126661','76561199495681364','76561199495776081',
'76561199495829742','76561199496069744','76561199496227456','76561199496330232','76561199496402393','76561199496442023',
'76561199496458456','76561199496671591','76561199496738518','76561199496745885','76561199496955989','76561199496960273',
'76561199496971940','76561199572957833','76561199573210567','76561199573214724','76561199573226985','76561199573312098',
'76561199573353380','76561199573375703','76561199573383502','76561199573410097','76561199573420385','76561199573449063',
'76561199573458882','76561199573465456','76561199573472161','76561199573582811','76561199573592419','76561199573601964',
'76561199573661388','76561199573695427','76561199573718102','76561199573726730','76561199573734358','76561199573768485',
'76561199573772808','76561199573790823','76561199573859348','76561199573895952','76561199573927234','76561199573933203',
'76561199573952614','76561199573959249','76561199573971888','76561199573999923','76561199574002078','76561199574005694',
'76561199574048928','76561199574105671','76561199574209870','76561199574226061','76561199835290638','76561199835368627',
'76561199835688432','76561199835793403','76561199836089272','76561199836477677','76561199836538185','76561199836978155',
'76561199836993540','76561198004735803','76561198005764608','76561198006024897','76561198007766613','76561198007864301',
'76561198008061185','76561198009702577','76561198009844065','76561198009970256','76561198011360419','76561198011507370',
'76561198011979027','76561198012764220','76561198012786360','76561198021032471','76561199186445733','76561199187931131',
'76561199191527226','76561199191570541','76561199353519026','76561199487147688','76561199487344108','76561199487361671',
'76561199487491807','76561199487708392','76561199488055800','76561199488248265','76561199488379473','76561199488595905',
'76561199488737022','76561199489024221','76561199489293318','76561199489567728','76561199489720032','76561199489774630',
'76561199489931345','76561199489964129','76561199495397299','76561199495798645','76561199495907859','76561199496113274',
'76561199496224781','76561199496228525','76561199496229894','76561199496252405','76561199496451287','76561199496586048',
'76561199496651111','76561199496694203','76561199497077390','76561199497105751','76561199497128036','76561199497347588',
'76561199572728933','76561199572815564','76561199572880472','76561199573039589','76561199573166576','76561199573174566',
'76561199573245087','76561199573296663','76561199573296703','76561199573301571','76561199573514960','76561199573533872',
'76561199573544395','76561199573550405','76561199573574226','76561199573586559','76561199573636832','76561199573645535',
'76561199573646599','76561199573660695','76561199573662867','76561199573678082','76561199573747993','76561199573763226',
'76561199573773381','76561199573784916','76561199573801710','76561199573816581','76561199573820950','76561199573835820',
'76561199573875054','76561199573902350','76561199573952269','76561199573975672','76561199573992628','76561199574029212',
'76561199574095391','76561199574096693','76561199574108969','76561199574189158','76561199835593583','76561199835797669',
'76561199835875056','76561199835943665','76561199835981349','76561199836170346','76561199836235727','76561199836484599',
'76561199836623819','76561199836950446','76561197992383333','76561198004784546','76561198004800605','76561198004994636',
'76561198007311915','76561198010036728','76561198012630531','76561198013354511','76561198013546668','76561198014226001',
'76561198016363245','76561198028641046','76561199003915121','76561199156994378','76561199186155126','76561199341633432',
'76561199486793115','76561199487171365','76561199487188609','76561199487756908','76561199487872846','76561199488050795',
'76561199488070571','76561199488135882','76561199488280244','76561199488322947','76561199488674814','76561199488687047',
'76561199489140134','76561199489181015','76561199489220407','76561199489646099','76561199489726770','76561199495272554',
'76561199495513817','76561199495617674','76561199496001019','76561199496001827','76561199496136235','76561199496281116',
'76561199496434423','76561199496474132','76561199496669131','76561199496695874','76561199496748871','76561199496824401',
'76561199496933444','76561199572962362','76561199572975372','76561199573179223','76561199573260798','76561199573365299',
'76561199573376539','76561199573385243','76561199573427854','76561199573492095','76561199573568569','76561199573594090',
'76561199573599282','76561199573601304','76561199573628497','76561199573644228','76561199573667770','76561199573706659',
'76561199573709546','76561199573739937','76561199573754797','76561199573795667','76561199573828407','76561199573829117',
'76561199573832890','76561199573839419','76561199573850139','76561199573851844','76561199573869020','76561199573893228',
'76561199573900135','76561199573907774','76561199573946129','76561199573981560','76561199573991605','76561199574003705',
'76561199574039370','76561199574082930','76561199574165432','76561199574188093','76561199574250770','76561199574509115',
'76561199574638352','76561199835971919','76561199836027616','76561199836103584','76561199836121084','76561199836219126',
'76561199836319696','76561199836401020','76561199836577063','76561199836691938','76561199836905182','76561198006551948',
'76561198007920119','76561198008145037','76561198008342309','76561198008590644','76561198009794696','76561198009958314',
'76561198010670982','76561198011188437','76561198012181522','76561198016029948','76561198016884594','76561198017233930',
'76561198018284220','76561198033048553','76561199093833328','76561199145300821','76561199184920278','76561199188869387',
'76561199191145332','76561199195626554','76561199486533160','76561199486756701','76561199487642121','76561199487979379',
'76561199488060553','76561199488181277','76561199488219789','76561199488238783','76561199488351517','76561199488500811',
'76561199489372971','76561199489603198','76561199489618005','76561199489663568','76561199489871066','76561199496116257',
'76561199496228471','76561199496416970','76561199496417779','76561199496497346','76561199496523352','76561199496574514',
'76561199496616686','76561199496664324','76561199496723661','76561199496743916','76561199496810378','76561199496948850',
'76561199497018923','76561199497237243','76561199573021274','76561199573143515','76561199573219973','76561199573234455',
'76561199573344687','76561199573347029','76561199573380811','76561199573382024','76561199573507092','76561199573507171',
'76561199573531732','76561199573547682','76561199573554537','76561199573563750','76561199573565761','76561199573585139',
'76561199573590375','76561199573598400','76561199573610785','76561199573684911','76561199573700670','76561199573717929',
'76561199573765733','76561199573783967','76561199573802638','76561199573808490','76561199573811992','76561199573821593',
'76561199573838926','76561199573845987','76561199573849551','76561199573868906','76561199573925631','76561199573942538',
'76561199574046319','76561199574128763','76561199574187111','76561199574202926','76561199574461274','76561199835787156',
'76561199835849827','76561199835927937','76561199835997278','76561199836009253','76561199836249311','76561199836334875',
'76561199836456265','76561199836705574','76561199837274524','76561198007667299','76561198008565289','76561198008578973',
'76561198008997824','76561198009534162','76561198009862925','76561198009908412','76561198010533068','76561198011402939',
'76561198011856806','76561198013881188','76561198014361836','76561198017595036','76561198993755095','76561199144439232',
'76561199266026870','76561199355955937','76561199380332744','76561199486872940','76561199486991319','76561199487314882',
'76561199487612972','76561199487686992','76561199487857799','76561199488012632','76561199488078467','76561199488128914',
'76561199488260620','76561199488496947','76561199488518544','76561199488627032','76561199488865230','76561199489088333',
'76561199489203629','76561199495370914','76561199495787230','76561199496026508','76561199496074573','76561199496238556',
'76561199496365187','76561199496389553','76561199496504070','76561199496694534','76561199496714603','76561199496998599',
'76561199497103943','76561199497174531','76561199497330208','76561199572930037','76561199573094006','76561199573187124',
'76561199573298087','76561199573340943','76561199573352203','76561199573365283','76561199573367564','76561199573375376',
'76561199573416584','76561199573449635','76561199573476621','76561199573482721','76561199573483831','76561199573532651',
'76561199573545056','76561199573551468','76561199573566227','76561199573579600','76561199573592850','76561199573626704',
'76561199573629987','76561199573666958','76561199573680536','76561199573714328','76561199573732694','76561199573792519',
'76561199573794440','76561199573862496','76561199573896225','76561199573909766','76561199573937302','76561199573953205',
'76561199573979213','76561199573981845','76561199574133104','76561199574137298','76561199574199421','76561199574333530',
'76561199574409923','76561199835779907','76561199836064571','76561199836215463','76561199836237875','76561199836238073',
'76561199836250812','76561199836353839','76561199836492106','76561199836643886','76561199836941150','76561197996839246',
'76561198004817718','76561198004943213','76561198007421735','76561198007658589','76561198010360916','76561198011166219',
'76561198011775752','76561198012727008','76561198012865705','76561198013310225','76561198014394093','76561198014889865',
'76561198016098749','76561198017343972','76561198017570967','76561198017898437','76561198026898348','76561199000314874',
'76561199186067398','76561199194980827','76561199213412085','76561199333464259','76561199486358469','76561199486937123',
'76561199486973269','76561199487203978','76561199487369299','76561199487970760','76561199488180248','76561199488735809',
'76561199488861465','76561199489193457','76561199489264846','76561199489421703','76561199489422738','76561199489532111',
'76561199489693282','76561199489846035','76561199490240223','76561199495816117','76561199495947004','76561199495994444',
'76561199496028249','76561199496062176','76561199496063219','76561199496154786','76561199496439723','76561199496458182',
'76561199496502806','76561199496794618','76561199496821087','76561199496825469','76561199496995339','76561199572695461',
'76561199572711408','76561199572867775','76561199573066754','76561199573107709','76561199573107878','76561199573127295',
'76561199573183917','76561199573244454','76561199573256389','76561199573257298','76561199573331720','76561199573374139',
'76561199573389111','76561199573402162','76561199573402374','76561199573414493','76561199573461488','76561199573472883',
'76561199573509360','76561199573553716','76561199573582701','76561199573584523','76561199573589041','76561199573650799',
'76561199573650929','76561199573663680','76561199573664542','76561199573727161','76561199573731640','76561199573763840',
'76561199573812460','76561199573822530','76561199573835655','76561199573995864','76561199574007932','76561199574112260',
'76561199574258921','76561199574342938','76561199574411279','76561199574784892','76561199835807915','76561199836109862',
'76561199836251217','76561199836252414','76561199836425103','76561199836511070','76561199836532348','76561199836532956',
'76561199836751465','76561199836973714','76561198005326993','76561198005772068','76561198006061648','76561198007067304',
'76561198009906360','76561198009912613','76561198011039575','76561198011040049','76561198011087007','76561198011636272',
'76561198011790488','76561198014273675','76561198016214851','76561198016403676','76561198017047244','76561198017749491',
'76561198018145004','76561199124726174','76561199182269277','76561199183841340','76561199189581018','76561199337956551',
'76561199368674766','76561199380890506','76561199486600439','76561199487051476','76561199487227797','76561199487395372',
'76561199487440925','76561199487764349','76561199488436689','76561199488514872','76561199488619718','76561199488824878',
'76561199489168763','76561199489794119','76561199490023145','76561199490116658','76561199490464802','76561199495821259',
'76561199495880353','76561199495975116','76561199496260756','76561199496325872','76561199496330048','76561199496341875',
'76561199496342547','76561199496429133','76561199496680344','76561199496779340','76561199496788190','76561199496907701',
'76561199496989854','76561199497582774','76561199572721936','76561199573038111','76561199573040238','76561199573112130',
'76561199573169083','76561199573234981','76561199573266489','76561199573352744','76561199573417068','76561199573478396',
'76561199573520937','76561199573523768','76561199573524198','76561199573539520','76561199573564239','76561199573573983',
'76561199573579610','76561199573583824','76561199573585387','76561199573634476','76561199573648822','76561199573677014',
'76561199573718514','76561199573762885','76561199573777924','76561199573778786','76561199573797538','76561199573815465',
'76561199573845767','76561199573848980','76561199573958376','76561199573974753','76561199574003192','76561199574175997',
'76561199574190989','76561199574224569','76561199574282754','76561199574410848','76561199574721966','76561199835595301',
'76561199836038654','76561199836091954','76561199836208446','76561199836498391','76561199836595868','76561199836596088',
'76561199836641763','76561199836763938','76561199837553808','76561197989423966','76561198005997024','76561198006748816',
'76561198006942833','76561198007849352','76561198010038484','76561198010625337','76561198013870435','76561198014145241',
'76561198014325326','76561198015562736','76561198015950646','76561198016000277','76561198016064685','76561198017077861',
'76561198990043219','76561199115152486','76561199152394970','76561199189490924','76561199310441949','76561199486526128',
'76561199486581677','76561199487362295','76561199487827043','76561199487835346','76561199487840570','76561199487868994',
'76561199487871328','76561199488011160','76561199488038205','76561199488060841','76561199488330716','76561199488608419',
'76561199488891065','76561199489248754','76561199489312227','76561199489714316','76561199495637145','76561199495643844',
'76561199496004092','76561199496015434','76561199496268110','76561199496273250','76561199496338141','76561199496357908',
'76561199496510564','76561199496529390','76561199496563148','76561199496846851','76561199496985952','76561199497013099',
'76561199497092725','76561199497135931','76561199572747365','76561199572809590','76561199572812950','76561199572828554',
'76561199573070209','76561199573170315','76561199573264033','76561199573276142','76561199573278134','76561199573289326',
'76561199573302407','76561199573309378','76561199573331752','76561199573359907','76561199573362507','76561199573398379',
'76561199573472176','76561199573484128','76561199573520655','76561199573553486','76561199573688603','76561199573720655',
'76561199573753216','76561199573763991','76561199573773797','76561199573800848','76561199573821089','76561199573829902',
'76561199573834618','76561199573888034','76561199573950619','76561199573967070','76561199574024232','76561199574052782',
'76561199574116272','76561199574144461','76561199574163628','76561199574287112','76561199574401521','76561199835602536',
'76561199835714035','76561199835788236','76561199835795597','76561199835928149','76561199836130005','76561199836226899',
'76561199836370919','76561199836770018','76561199837089473','76561198005431705','76561198005477449','76561198005587518',
'76561198006443045','76561198007599964','76561198009972733','76561198010012763','76561198011645330','76561198011918497',
'76561198014221038','76561198014639808','76561198016386183','76561198017945295','76561198037430564','76561198987515581',
'76561198993281452','76561199040623779','76561199181290571','76561199185686175','76561199189432278','76561199306770051',
'76561199487005719','76561199487327979','76561199487497538','76561199487920526','76561199487955621','76561199488172342',
'76561199488199331','76561199488539400','76561199488877743','76561199489021514','76561199489060963','76561199489460772',
'76561199489611162','76561199489745505','76561199495078579','76561199495527988','76561199496112771','76561199496118421',
'76561199496211919','76561199496216944','76561199496254369','76561199496430534','76561199496444525','76561199496508051',
'76561199496610665','76561199496769541','76561199496846289','76561199497015619','76561199497124322','76561199573015479',
'76561199573107385','76561199573134835','76561199573191926','76561199573232660','76561199573247369','76561199573305477',
'76561199573335544','76561199573418717','76561199573465827','76561199573469166','76561199573475778','76561199573514037',
'76561199573514884','76561199573576976','76561199573614045','76561199573635241','76561199573712128','76561199573720242',
'76561199573742115','76561199573774228','76561199573789349','76561199573801223','76561199573837379','76561199573838752',
'76561199573839894','76561199573848485','76561199573896785','76561199573908950','76561199573924483','76561199573933918',
'76561199573934231','76561199573964723','76561199573986410','76561199574067723','76561199574071188','76561199574111760',
'76561199574145928','76561199574193916','76561199574384089','76561199835618252','76561199835762125','76561199835985512',
'76561199836261760','76561199836271024','76561199836584366','76561199836604366','76561199836616157','76561199836844944',
'76561199837446074','76561199573178014',

    #meow#bibilu#lulu-koko#✪✪✪
    
    
]


DATA_FILE = 'friend_data.json'
INIT_FILE = '.initialized'

# Optimized rate limiting configuration for speed
MAX_CONCURRENT_REQUESTS = 50  # High concurrency
REQUEST_DELAY = 0.1  # Very short delay between requests
BURST_SIZE = 100  # Allow bursts of requests
BURST_DELAY = 5  # Pause after each burst
MAX_RETRIES = 2  # Limit retries to keep speed up

logging.basicConfig(level=logging.INFO, format='%(asctime)s - %(levelname)s - %(message)s')
logger = logging.getLogger("SteamFriendIDMonitor")

class FastRateLimiter:
    def __init__(self, max_concurrent=50, burst_size=100, burst_delay=5):
        self.semaphore = asyncio.Semaphore(max_concurrent)
        self.burst_size = burst_size
        self.burst_delay = burst_delay
        self.request_count = 0
        self.last_burst_reset = None
        self.loop = None
    
    async def acquire(self):
        if self.loop is None:
            self.loop = asyncio.get_event_loop()
            self.last_burst_reset = self.loop.time()
        
        await self.semaphore.acquire()
        
        # Check if we need to pause after a burst
        self.request_count += 1
        if self.request_count >= self.burst_size:
            current_time = self.loop.time()
            time_since_reset = current_time - self.last_burst_reset
            
            if time_since_reset < self.burst_delay:
                sleep_time = self.burst_delay - time_since_reset
                logger.debug(f"Burst limit reached, sleeping for {sleep_time:.2f}s")
                await asyncio.sleep(sleep_time)
            
            self.request_count = 0
            self.last_burst_reset = self.loop.time()
        
        # Small delay to prevent hammering
        await asyncio.sleep(0.05 + random.uniform(0, 0.05))
    
    def release(self):
        self.semaphore.release()

# Rate limiter will be created inside the main function

def get_profile_link(steam_id):
    """Generate Steam profile link from Steam ID"""
    return f"steamcommunity.com/profiles/{steam_id}"

async def fetch_friend_list(session, steam_id, rate_limiter, retry_count=0):
    """Fetch the complete friend list for a Steam account with optimized rate limiting"""
    url = f"http://api.steampowered.com/ISteamUser/GetFriendList/v0001/?key={STEAM_API_KEY}&steamid={steam_id}&relationship=friend"
    profile_link = get_profile_link(steam_id)
    
    await rate_limiter.acquire()
    try:
        async with session.get(url, timeout=10) as resp:
            if resp.status == 200:
                data = await resp.json()
                friends_data = data.get('friendslist', {}).get('friends', [])
                friend_ids = [friend['steamid'] for friend in friends_data]
                return steam_id, profile_link, friend_ids
            elif resp.status == 403:
                logger.debug(f"{profile_link} is private")
                return steam_id, profile_link, None
            elif resp.status in [429, 420]:
                if retry_count < MAX_RETRIES:
                    # Exponential backoff for rate limits
                    delay = (2 ** retry_count) + random.uniform(0, 1)
                    logger.warning(f"{profile_link}: Rate limited, retrying in {delay:.2f}s")
                    await asyncio.sleep(delay)
                    return await fetch_friend_list(session, steam_id, rate_limiter, retry_count + 1)
                else:
                    logger.error(f"{profile_link}: Max retries exceeded for rate limit")
                    return steam_id, profile_link, None
            else:
                logger.warning(f"{profile_link}: API error {resp.status}")
                return steam_id, profile_link, None
    except asyncio.TimeoutError:
        logger.warning(f"Timeout fetching {profile_link}")
        return steam_id, profile_link, None
    except Exception as e:
        logger.warning(f"Error fetching {profile_link}: {e}")
        return steam_id, profile_link, None
    finally:
        rate_limiter.release()

async def send_telegram_message(message):
    """Send message to Telegram, splitting if too long"""
    MAX_MESSAGE_LENGTH = 4000
    
    if len(message) <= MAX_MESSAGE_LENGTH:
        await _send_single_message(message)
    else:
        lines = message.split('\n')
        current_chunk = ""
        
        for line in lines:
            if len(current_chunk + line + '\n') > MAX_MESSAGE_LENGTH:
                if current_chunk:
                    await _send_single_message(current_chunk.strip())
                    current_chunk = line + '\n'
                else:
                    await _send_single_message(line[:MAX_MESSAGE_LENGTH])
            else:
                current_chunk += line + '\n'
        
        if current_chunk:
            await _send_single_message(current_chunk.strip())

async def _send_single_message(message):
    """Send a single message to Telegram"""
    url = f"https://api.telegram.org/bot{TELEGRAM_BOT_TOKEN}/sendMessage"
    payload = {
        'chat_id': TELEGRAM_CHAT_ID,
        'text': message,
        'parse_mode': 'HTML'
    }
    async with aiohttp.ClientSession() as session:
        try:
            async with session.post(url, data=payload) as resp:
                if resp.status != 200:
                    logger.error(f"Failed to send message: {await resp.text()}")
                else:
                    logger.info("Telegram message sent successfully")
        except Exception as e:
            logger.error(f"Telegram error: {e}")

def load_previous_data():
    """Load previous friend data from file"""
    try:
        with open(DATA_FILE, 'r') as f:
            return json.load(f)
    except:
        return {}

def save_data(data):
    """Save friend data to file"""
    with open(DATA_FILE, 'w') as f:
        json.dump(data, f, indent=2)

def is_first_run():
    """Check if this is the first run of the bot"""
    if os.path.exists(INIT_FILE):
        return False
    with open(INIT_FILE, 'w') as f:
        f.write(datetime.now().isoformat())
    return True

async def check_accounts():
    """Main function to check all accounts for friend changes - optimized for speed"""
    start_time = time.time()
    first_run = is_first_run()
    previous_data = load_previous_data()
    current_data = {}
    all_new_friends = []
    
    # Create rate limiter inside the async function
    rate_limiter = FastRateLimiter(MAX_CONCURRENT_REQUESTS, BURST_SIZE, BURST_DELAY)
    
    logger.info(f"Starting fast check for {len(STEAM_ACCOUNTS)} accounts...")
    
    # Optimized session configuration for high throughput
    connector = aiohttp.TCPConnector(
        limit=200,  # High connection pool
        limit_per_host=100,  # High per-host limit
        ttl_dns_cache=300,  # DNS cache
        use_dns_cache=True,
        keepalive_timeout=30,
        enable_cleanup_closed=True
    )
    
    timeout = aiohttp.ClientTimeout(total=15, connect=5)
    
    async with aiohttp.ClientSession(
        connector=connector, 
        timeout=timeout,
        headers={'User-Agent': 'SteamFriendMonitor/1.0'}
    ) as session:
        
        # Create all tasks at once for maximum concurrency
        tasks = [fetch_friend_list(session, steam_id, rate_limiter) for steam_id in STEAM_ACCOUNTS]
        
        # Progress tracking
        completed = 0
        total = len(tasks)
        
        # Process all requests concurrently with progress updates
        for coro in asyncio.as_completed(tasks):
            try:
                steam_id, profile_link, friend_ids = await coro
                completed += 1
                
                # Progress update every 500 accounts
                if completed % 500 == 0 or completed == total:
                    elapsed = time.time() - start_time
                    rate = completed / elapsed
                    eta = (total - completed) / rate if rate > 0 else 0
                    logger.info(f"Progress: {completed}/{total} ({completed/total*100:.1f}%) - {rate:.1f} req/s - ETA: {eta:.1f}s")
                
                if friend_ids is None:
                    continue
                    
                current_data[steam_id] = {
                    'profile_link': profile_link,
                    'friends': friend_ids,
                    'count': len(friend_ids)
                }
                
                # Skip change detection on first run
                if first_run or steam_id not in previous_data:
                    continue
                    
                previous_friends = set(previous_data[steam_id].get('friends', []))
                current_friends = set(friend_ids)
                
                # Check for new friends only
                new_friends = current_friends - previous_friends
                if new_friends:
                    for friend_id in new_friends:
                        friend_profile_link = get_profile_link(friend_id)
                        all_new_friends.append(friend_profile_link)
                        logger.info(f"New friend detected: {friend_id} added to {steam_id}")
                
                # Log removed friends (no telegram notification)
                removed_friends = previous_friends - current_friends
                if removed_friends:
                    for friend_id in removed_friends:
                        logger.debug(f"Friend removed: {friend_id} removed from {steam_id}")
                        
            except Exception as e:
                logger.error(f"Error processing task: {e}")
                completed += 1

    total_time = time.time() - start_time
    successful_accounts = len(current_data)
    avg_rate = successful_accounts / total_time if total_time > 0 else 0
    
    logger.info(f"Completed in {total_time:.2f}s - {avg_rate:.1f} accounts/sec - {successful_accounts}/{len(STEAM_ACCOUNTS)} successful")

    # Send batched notification for all new friends
    logger.info(f"Total new friends collected: {len(all_new_friends)}")
    
    if all_new_friends and not first_run:
        if len(all_new_friends) == 1:
            msg = f"New friend: {all_new_friends[0]}"
        else:
            msg = f"New friends detected ({len(all_new_friends)}):\n\n"
            msg += "\n".join([f"• {friend_link}" for friend_link in all_new_friends])
        
        logger.info(f"Sending Telegram notification for {len(all_new_friends)} new friends")
        await send_telegram_message(msg)
    elif all_new_friends and first_run:
        logger.info(f"New friends detected on first run (not sending notification): {len(all_new_friends)}")
    else:
        logger.info("No new friends detected in this cycle")

    # Save current data
    save_data(current_data)

    if first_run:
        total_accounts = len(current_data)
        private_accounts = len(STEAM_ACCOUNTS) - total_accounts
        total_friends = sum(data['count'] for data in current_data.values())
        
        logger.info(f"Steam Friend ID Monitor Setup Complete")
        logger.info(f"Monitoring {total_accounts} accounts")
        logger.info(f"Total friends being tracked: {total_friends}")
        if private_accounts > 0:
            logger.info(f"{private_accounts} accounts are private")
        logger.info("Bot will now notify when specific friends are added with their Steam IDs")
    else:
        logger.info(f"Friend check completed. Successfully processed {successful_accounts} accounts in {total_time:.2f}s")

if __name__ == '__main__':
    asyncio.run(check_accounts())
