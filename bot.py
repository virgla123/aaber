import os
import json
import asyncio
import aiohttp
import logging
from datetime import datetime

# Configuration
TELEGRAM_BOT_TOKEN = os.environ.get('TELEGRAM_BOT_TOKEN', '')
TELEGRAM_CHAT_ID = os.environ.get('TELEGRAM_CHAT_ID', '')
STEAM_API_KEY = os.environ.get('STEAM_API_KEY', '')

STEAM_ACCOUNTS = [

    '76561197996398575','76561197996593424','76561197996675026','76561197997017699','76561197997086477','76561197997141383',
    '76561197997251442','76561197997427804','76561197997700403','76561197998365855','76561197998641373','76561197998681459',
    '76561197998776248','76561197998852994','76561197999271462','76561197999359231','76561197999432650','76561197999556739',
    '76561197999937040','76561197999980555','76561198000388892','76561198000534531','76561198000651707','76561198000784002',
    '76561198000818984','76561198001089298','76561198001556761','76561198001619698','76561198001759912','76561198001974200',
    '76561198002256476','76561198002340823','76561198002349549','76561198002459076','76561198002459750','76561198002554419',
    '76561198003044105','76561198003207494','76561198003388842','76561198003476125','76561198004707936','76561198004805385',
    '76561198004832305','76561198005191036','76561198005198966','76561198005900730','76561198005912702','76561198005999650',
    '76561198006034833','76561198006051612','76561198006117832','76561198014705555','76561198015235796','76561198015671463',
    '76561198006697194','76561198006706212','76561198006819655','76561198007055256','76561198007471136','76561198007799475',
    '76561198007919087','76561198008296760','76561198008531439','76561198008633057','76561198008706562','76561198008896023',
    '76561198009060713','76561198009188599','76561198009295963','76561198009427867','76561198009824969','76561198009833895',
    '76561198010136751','76561198010179885','76561198010370267','76561198011047529','76561198011104186','76561198011218548',
    '76561198011381688','76561198011453078','76561198011511861','76561198011678928','76561198011942597','76561198012012675',
    '76561198012175452','76561198012243254','76561198012393433','76561198012593717','76561198012708397','76561198012761378',
    '76561198012789099','76561198012825733','76561198013215682','76561198013288262','76561198013598292','76561198013615882',
    '76561198013626622','76561198013641401','76561198014135072','76561198014286820','76561198014551891','76561198014686146',
    '76561198016426731','76561198016996825','76561198017222642','76561198017651325','76561198018360376','76561198018550346',
    '76561198019564419','76561198019895271','76561198020008419','76561198020304487','76561198020835117','76561198021809052',
    '76561198022710386','76561198024152078','76561198277734415','76561198297485191','76561198324875900','76561198353084317',
    '76561198376026602','76561198406772253','76561198810958828','76561198818923045','76561198838506206','76561198839240066',
    '76561198864238036','76561198929584803','76561199013884625','76561199042336745','76561199045275075','76561199083142895',
    '76561199089423387','76561199100844379','76561199101020312','76561199103465820','76561199112081002','76561199120945100',
    '76561199124802775','76561199161152693','76561199162850508','76561199164835947','76561199165932523','76561199175310280',
    '76561199234161343','76561199235455488','76561199252034327','76561199260585709','76561199260919197','76561199285864797',
    '76561199287527233','76561199311090772','76561199331590967','76561199349446379','76561199349889645','76561199375677249',
    '76561199376597804','76561199388014916','76561199422348238','76561199429104629','76561199433474078','76561199441308998',
    '76561199468878961','76561199481076431','76561199481986035','76561199488187198','76561199497383253','76561199559748634',
    '76561199560043272','76561199560433277','76561199560725504','76561199560781008','76561197993282532','76561197993333083',
    '76561199560794873','76561199560860193','76561199560927144','76561199560931107','76561199560948511','76561199561433095',
    '76561199561434547','76561199561801760','76561199561804295','76561199561877807','76561199561941559','76561199561949896',
    '76561199561964756','76561199562094997','76561199562170998','76561199562225365','76561199562415917','76561199562489209',
    '76561199825791836','76561199825905806','76561199826314886','76561199826393974','76561199826467294','76561199826550363',
    '76561199826584530','76561199826642018','76561199826675202','76561199826707532','76561199826720893','76561199826741233',
    '76561199826800042','76561199826847024','76561199826866105','76561199826866219','76561199826916624','76561199826921542',
    '76561199826934357','76561199826951975','76561199826961067','76561199826975054','76561199826979272','76561199826979326',
    '76561199827025515','76561199827039052','76561199827040041','76561199827045656','76561199827057302','76561199827065658',
    '76561199827075948','76561199827076187','76561199827076355','76561199827947429','76561199827966156','76561199827971633',
    '76561199827094720','76561199827106910','76561199827106966','76561199827114887','76561199827123274','76561199827153569',
    '76561199827158898','76561199827159892','76561199827168263','76561199827170388','76561199827175291','76561199827179736',
    '76561199827182298','76561199827183108','76561199827188023','76561199827190247','76561199827220809','76561199827228426',
    '76561199827236395','76561199827244423','76561199827250478','76561199827251931','76561199827253117','76561199827264334',
    '76561199827266727','76561199827278648','76561199827283223','76561199827295778','76561199827297923','76561199827305526',
    '76561199827307176','76561199827358594','76561199827368807','76561199827384528','76561199827388012','76561199827389405',
    '76561199827392644','76561199827399974','76561199827421382','76561199827428060','76561199827435557','76561199827479667',
    '76561199827508053','76561199827509510','76561199827510477','76561199827512687','76561199827515934','76561199827530562',
    '76561199827572803','76561199827575675','76561199827575938','76561199827587111','76561199827601416','76561199827609737',
    '76561199827615851','76561199827624447','76561199827626045','76561199827627703','76561199827633961','76561199827637760',
    '76561199827642992','76561199827653755','76561199827670819','76561199827671663','76561199827679304','76561199827689033',
    '76561199827694559','76561199827709877','76561199827710270','76561199827721257','76561199827722905','76561199827731291',
    '76561199827733935','76561199827737263','76561199827771096','76561199827771742','76561199827782199','76561199827789122',
    '76561199827790514','76561199827795137','76561199827816102','76561199827847768','76561199827850062','76561199827871014',
    '76561199827900396','76561199827901611','76561199827903674','76561199827904216','76561199827905422','76561199827909162',
    '76561199827913028','76561199827928818','76561199827942295','76561199827943124','76561199827944309','76561199827946560',
    '76561199827990123','76561199827992512','76561199827994204','76561199828005369','76561199828042984','76561199828043039',
    '76561199828050742','76561199828051933','76561199828072453','76561199828083582','76561199828084661','76561199828085846',
    '76561199828096858','76561199828111092','76561199828112391','76561199828123630','76561199828129847','76561199828159795',
    '76561199828168219','76561199828180410','76561199828199884','76561199828200528','76561199828204201','76561199828204794',
    '76561199828241214','76561199828274871','76561199828275403','76561199828290900','76561199828292399','76561199828293824',
    '76561199828294143','76561199828305546','76561199828329951','76561199828334380','76561199828348979','76561199828369050',
    '76561199828372428','76561199828378722','76561199828406729','76561199828423686','76561199828430424','76561199828443015',
    '76561199828462654','76561199828465458','76561199828485417','76561199828490556','76561199828494103','76561199828508973',
    '76561199828510697','76561199828522241','76561199828531008','76561199827539490','76561199827550053','76561199827572803',
    '76561199828532240','76561199828542064','76561199828543743','76561199828550030','76561199828575254','76561199828600807',
    '76561199828611984','76561199828613974','76561199828621155','76561199828649540','76561199828652394','76561199828683129',
    '76561199828712303','76561199828713141','76561199828716495','76561199828740164','76561199828748347','76561199828873502',
    '76561199828884735','76561199828956768','76561199828986817','76561199829048656','76561199829060117','76561199829125751',
    '76561199829267905','76561199829318408','76561199829350908','76561197987508133','76561197988058514','76561197988337937',
    '76561197988389678','76561197989199990','76561197989452649','76561197990430309','76561197990808814','76561197990903525',
    '76561197990914186','76561197990949327','76561197990982690','76561197991030274','76561197991033524','76561197991111102',
    '76561197991455362','76561197991643260','76561197991843754','76561197992198029','76561197992278826','76561197992308818',
    '76561197992677393','76561197992779273','76561197992788717','76561197993063936','76561197993380528','76561197993399332',
    '76561197993497963','76561197993698556','76561197993728657','76561197993759535','76561197993861914','76561197994397979',
    '76561197994652263','76561197994708101','76561197994817319','76561197995660731','76561197995779615','76561197995934124',
    '76561197996337196','76561197996390423','76561197996409136','76561197996601446','76561197996610305','76561197996650939',
    '76561197996728674','76561197996865410','76561197997115871','76561197997817102','76561197997876005','76561197998376505',
    '76561197998379469','76561197998665444','76561197998708346','76561197998784979','76561197999130852','76561197999244441',
    '76561197999378442','76561197999691778','76561197999785281','76561198000195065','76561198000683813','76561198000817295',
    '76561198000891412','76561198001240173','76561198001365732','76561198001491647','76561198002393790','76561198003272275',
    '76561198003839832','76561198003860602','76561198004064329','76561197992494240','76561197992617515','76561197992619876',
    '76561198004119915','76561198004290197','76561198004686926','76561198004782736','76561198004866054','76561198005106330',
    '76561198005344373','76561198005522139','76561198005704244','76561198006002389','76561198006073597','76561198006444165',
    '76561198006580251','76561198006723784','76561198006848366','76561198007380053','76561198007872748','76561198008301969',
    '76561198008414837','76561198008775645','76561198008886736','76561198008952582','76561198009216029','76561198009232668',
    '76561198009738125','76561198009873730','76561198010203436','76561198010311684','76561198010543100','76561198010825182',
    '76561198010872668','76561198011455098','76561198011463121','76561198012017552','76561198012085852','76561198012857228',
    '76561198012969302','76561198012999234','76561198013143045','76561198013246551','76561198013675938','76561198013905125',
    '76561198014029550','76561198014392702','76561198014617060','76561198014806014','76561198015117205','76561198015352402',
    '76561198015975344','76561198015986916','76561198016751088','76561198017014270','76561198017062540','76561198017187811',
    '76561198017468047','76561198017848098','76561198017896821','76561198017899735','76561198018109488','76561198018374462',
    '76561198018474894','76561198018477188','76561198019039895','76561198019298402','76561198020956106','76561198021253681',
    '76561198022450297','76561198023045770','76561198023265169','76561198023795806','76561198023917821','76561198033149962',
    '76561198147980071','76561198378904188','76561198385464718','76561198409387221','76561198815479909','76561198823109782',
    '76561198823340439','76561198864655030','76561198866913427','76561198868809082','76561198958181252','76561198993622864',
    '76561198999419031','76561199020236710','76561199055845899','76561199058504452','76561199058852290','76561199069319214',
    '76561199079459005','76561199085890249','76561199093031335','76561199106152345','76561199124607010','76561199135050334',
    '76561199154584205','76561199160826174','76561199172564303','76561199173542681','76561199207715797','76561199208139006',
    '76561199219182087','76561199223762958','76561199228461547','76561199236458645','76561199259707660','76561199294713614',
    '76561199311227505','76561199341912181','76561199364492639','76561199368053191','76561199370587323','76561199370605152',
    '76561199375792051','76561199385529637','76561199395504235','76561199401741004','76561199403834531','76561199404224939',
    '76561199405401743','76561199408937360','76561199433686413','76561199434258051','76561199473255846','76561199486373425',
    '76561199487528930','76561199502417467','76561199508962517','76561199559552579','76561199559586378','76561199559716245',
    '76561199559759877','76561199180673463','76561199199075941','76561199211274745','76561199218560195','76561199152225190',
    '76561199559813893','76561199559838166','76561199560079523','76561199560159335','76561199560214878','76561199560338968',
    '76561199560398255','76561199560560011','76561199560606993','76561199560722866','76561199560917453','76561199561374096',
    '76561199561490101','76561199561589013','76561199561673562','76561199561741449','76561199561777386','76561199561817169',
    '76561199561819589','76561199561869328','76561199561998593','76561199562072007','76561199562084975','76561199562330974',
    '76561199562357412','76561199562411497','76561199562731211','76561199826256301','76561199826273018','76561199826295808',
    '76561199826357911','76561199826489788','76561199826497890','76561199826531346','76561199826592322','76561199826628139',
    '76561199826630502','76561199826637717','76561199826640018','76561199826640294','76561199826648049','76561199826681068',
    '76561199826687554','76561199826704258','76561199826756122','76561199826759058','76561199826762119','76561199826762414',
    '76561199826812299','76561199826828000','76561199826840128','76561198015473371','76561198015570163','76561198015579681',
    '76561199826854414','76561199826899950','76561199826936608','76561199826950265','76561199826952512','76561199826964989',
    '76561199826967220','76561199826982470','76561199826987573','76561199826990351','76561199827021167','76561199827052830',
    '76561199827068908','76561199827068991','76561199827091450','76561199827092609','76561199827093992','76561199827099873',
    '76561199827104309','76561199827106057','76561199827139161','76561199827142422','76561199827152854','76561199827171710',
    '76561199827172395','76561199827191652','76561199827193352','76561199827203737','76561199827215374','76561199827239444',
    '76561199827246716','76561199827246831','76561199827269843','76561199827273602','76561199827273806','76561199827276039',
    '76561199827282626','76561199827288118','76561199827309839','76561199827321941','76561199827326139','76561199827328280',
    '76561199827330561','76561199827335846','76561199827362261','76561199827362639','76561199827366338','76561199827370550',
    '76561199827403872','76561199827411682','76561199827415818','76561199827415945','76561199827423729','76561199827439469',
    '76561199827446357','76561199827474241','76561199827482202','76561199827483347','76561199827485966','76561199827515705',
    '76561199827533249','76561199827534877','76561199827536265','76561199827539408','76561199827546649','76561199827556302',
    '76561199827574462','76561199827577103','76561199827586662','76561199827604424','76561199827608784','76561199827611757',
    '76561199827612753','76561199827619197','76561199827626610','76561199827644894','76561199827648176','76561199827649757',
    '76561199827678734','76561199827685283','76561199827685451','76561199827691025','76561199827696064','76561199827703616',
    '76561199827717402','76561199827729124','76561199827737915','76561199827744792','76561199827747893','76561199827757589',
    '76561199827774449','76561199827783823','76561199827787267','76561199827795079','76561199827804915','76561199827808768',
    '76561199827843298','76561199827855363','76561199827858643','76561199827871802','76561199827880016','76561199827880558',
    '76561199827893393','76561199827893862','76561199827897725','76561199827898536','76561199827902050','76561199827902315',
    '76561199827905377','76561199827921145','76561199827945512','76561199827951650','76561199827953705','76561199827956745',
    '76561199827958821','76561199827966072','76561199827966162','76561199827967932','76561199827968359','76561199827970606',
    '76561199827997907','76561199828007543','76561199828012043','76561199828015432','76561199828032196','76561199828045127',
    '76561199828052034','76561199828052627','76561199828057563','76561199828088086','76561199828111640','76561199828120878',
    '76561199828129290','76561199828130325','76561199828133867','76561199828137473','76561199828146733','76561199828149760',
    '76561199828172551','76561199828173112','76561199828173658','76561199828173738','76561199828175698','76561199828225087',
    '76561199828232406','76561199828242507','76561199828248594','76561199827371732','76561199827395403','76561199827400638',
    '76561199828267108','76561199828280472','76561199828283108','76561199828302022','76561199828303539','76561199828312286',
    '76561199828344437','76561199828348365','76561199828358042','76561199828375077','76561199828394201','76561199828399129',
    '76561199828400530','76561199828480135','76561199828482918','76561199828500513','76561199828522700','76561199828528059',
    '76561199828549541','76561199828557309','76561199828616470','76561199828645632','76561199828673300','76561199828727131',
    '76561199828735893','76561199828739341','76561199828765162','76561199828810546','76561199828828466','76561199828925962',
    '76561199828942875','76561199828987841','76561199829033085','76561199829058393','76561199829506679','76561197987964262',
    '76561197988489619','76561197988824710','76561197989496786','76561197989810823','76561197990936071','76561197990946931',
    '76561197991745275','76561197992312224','76561197992334332','76561197992437670','76561197993101612','76561197993110200',
    '76561197993626623','76561197993644094','76561197994008402','76561197994028009','76561197994555248','76561197994600845',
    '76561197994706685','76561197995046201','76561197995108375','76561197995136266','76561197995383162','76561197995559473',
    '76561197995673522','76561197995746047','76561197996124462','76561197996396983','76561197996409457','76561197996503673',
    '76561197996910299','76561197996984799','76561197997301575','76561197997348057','76561197997478176','76561197998473482',
    '76561197998799146','76561197998834770','76561197998839623','76561197999099725','76561197999123729','76561197999341072',
    '76561197999398883','76561198000007757','76561198000108542','76561198000187186','76561198000241926','76561198000361424',
    '76561198000708194','76561198000900670','76561198001753775','76561198001812428','76561198002077183','76561198002114585',
    '76561198002484896','76561198002505715','76561198002993481','76561198003016879','76561198003404664','76561198003580513',
    '76561198003651672','76561198003690834','76561198003820677','76561199827815346','76561199827818271','76561199827839897',
    '76561198003820677','76561198003833799','76561198003923750','76561198003971749','76561198004313186','76561198005162594',
    '76561198005410915','76561198006018636','76561198006143803','76561198006145052','76561198006209655','76561198007001219',
    '76561198007476501','76561198007561801','76561198007580445','76561198007719058','76561198007846716','76561198008025836',
    '76561198008113072','76561198008385468','76561198009364071','76561198009687590','76561198009939285','76561198010070623',
    '76561198010253298','76561198010479989','76561198010683096','76561198010783959','76561198010841989','76561198010917612',
    '76561198011131422','76561198011379600','76561198011501934','76561198012634588','76561198012634894','76561198012888100',
    '76561198013060240','76561198013564878','76561198013686737','76561198013703739','76561198013757814','76561198013767576',
    '76561198013838601','76561198014160193','76561198014576815','76561198015046488','76561198015322573','76561198015482503',
    '76561198015836587','76561198015908980','76561198015943586','76561198016297422','76561198016373785','76561198016391900',
    '76561198016416238','76561198016465354','76561198016583602','76561198016774173','76561198017111197','76561198018064227',
    '76561198018249715','76561198018425120','76561198018482639','76561198019057854','76561198020922949','76561198021048258',
    '76561198021781218','76561198021794950','76561198022330646','76561198022405096','76561198022724042','76561198024012033',
    '76561198351343963','76561198405231517','76561198867740797','76561198977708782','76561198982175936','76561198984798073',
    '76561198986867557','76561198990023876','76561199007100824','76561199044196219','76561199060491894','76561199066507241',
    '76561199074844529','76561199086694753','76561199087057995','76561199116349543','76561199124476368','76561199153793444',
    '76561199156932865','76561199157261855','76561199166308194','76561199166717061','76561199167046466','76561199170655543',
    '76561199182183672','76561199207802629','76561199211165749','76561199221284127','76561199224021679','76561199242524146',
    '76561199266979286','76561199276331634','76561199375925340','76561199376199761','76561199402739728','76561199407106424',
    '76561199410020043','76561199413690735','76561199414216175','76561199428614748','76561199429291270','76561199433864877',
    '76561199445032702','76561199445457746','76561199479905697','76561199483307276','76561199559544879','76561199559907334',
    '76561199560078661','76561199560106745','76561199560140940','76561199560330367','76561199560610776','76561199560636531',
    '76561199560913517','76561199561023231','76561199561047026','76561199561584783','76561199561678260','76561199561774662',
    '76561199561960218','76561199562111233','76561199562114638','76561199562158741','76561199562171194','76561199488172563',
    '76561199562309608','76561199562360903','76561199562524561','76561199826517885','76561199826525523','76561199826527765',
    '76561199826755104','76561199826785391','76561199826789489','76561199826792554','76561199826804880','76561199826836986',
    '76561199826893670','76561199826901591','76561199826942535','76561199826964047','76561199826964568','76561199826965168',
    '76561199826981103','76561199827009973','76561199827026377','76561199827047091','76561199827061207','76561199827071982',
    '76561199827100782','76561199827102974','76561199827111405','76561199827129826','76561199827145423','76561199827158824',
    '76561199827166540','76561199827178955','76561199827186068','76561199827190869','76561199827198619','76561199827199996',
    '76561199827223865','76561199827244790','76561199827246584','76561199827250208','76561199827250671','76561199827261409',
    '76561199827264657','76561199827266574','76561199827275330','76561199827286218','76561199827308829','76561199827315526',
    '76561199827319442','76561199827326870','76561199827339700','76561198015585195','76561198015768994','76561198015780224',
    '76561199827344648','76561199827378567','76561199827379909','76561199827385445','76561199827394851','76561199827399044',
    '76561199827401722','76561199827403780','76561199827408168','76561199827433049','76561199827443402','76561199827455717',
    '76561199827459195','76561199827465073','76561199827470223','76561199827476315','76561199827481766','76561199827482777',
    '76561199827494299','76561199827503432','76561199827507326','76561199827512059','76561199827524741','76561199827525655',
    '76561199827548882','76561199827550062','76561199827555347','76561199827557369','76561199827564589','76561199827568728',
    '76561199827572875','76561199827574252','76561199827591383','76561199827596510','76561199827597569','76561199827598066',
    '76561199827599931','76561199827613170','76561199827613574','76561199827613751','76561199827626501','76561199827627735',
    '76561199827638926','76561199827650604','76561199827650617','76561199827655917','76561199827658780','76561199827663819',
    '76561199827682795','76561199827690235','76561199827690326','76561199828103402','76561199828104551','76561199828109577',
    '76561199827692753','76561199827716890','76561199827720891','76561199827726295','76561199827726722','76561199827730588',
    '76561199827746221','76561199827757029','76561199827757438','76561199827765071','76561199827772714','76561199827790638',
    '76561199827805965','76561199827849766','76561199827852185','76561199827868409','76561199827872958','76561199827873592',
    '76561199827881703','76561199827886940','76561199827888126','76561199827888867','76561199827890494','76561199827895131',
    '76561199827904855','76561199827910803','76561199827912474','76561199827919592','76561199827921428','76561199827928496',
    '76561199827946242','76561199827951884','76561199827954828','76561199827965838','76561199827970639','76561199827983363',
    '76561199827983840','76561199827985230','76561199827985570','76561199827988599','76561199827996326','76561199828000265',
    '76561199828042125','76561199828044047','76561199828056079','76561199828070648','76561199828083187','76561199828095595',
    '76561199828113193','76561199828121218','76561199828162110','76561199828162290','76561199828166032','76561199828170755',
    '76561199828174981','76561199828176214','76561199828182207','76561199828188384','76561199828200258','76561199828208218',
    '76561199828216081','76561199828216225','76561199828217133','76561199828226534','76561199828233471','76561199828237034',
    '76561199828246142','76561199828250025','76561199828256632','76561199828258466','76561199828269617','76561199828271783',
    '76561199828280624','76561199828281298','76561199828283886','76561199828284282','76561199828305218','76561199828307477',
    '76561199828307499','76561199828332225','76561199828337207','76561199828348295','76561199828370031','76561199828370343',
    '76561199828373325','76561199828393965','76561199828398908','76561199828408607','76561199828409094','76561199828428069',
    '76561199828428931','76561199828429708','76561199828442326','76561199828449049','76561199828463449','76561199828469625',
    '76561199828473702','76561199828505403','76561199828520483','76561199172093517','76561199182183672','76561199562277284',
    '76561199828523962','76561199828525935','76561199828534692','76561199828547664','76561199828551817','76561199828558943',
    '76561199828563931','76561199828567251','76561199828567448','76561199828568270','76561199828571806','76561199828581592',
    '76561199828602658','76561199828607416','76561199828622560','76561199828631977','76561199828637096','76561199828664880',
    '76561199828677065','76561199828682570','76561199828693904','76561199828773274','76561199828803946','76561199828832295',
    '76561199828834547','76561199828845077','76561199828879188','76561199829006212','76561199829114233','76561197987701607',
    '76561197989004699','76561197989193395','76561197989493336','76561197989520345','76561197990143390','76561197990683799',
    '76561197990943244','76561197991024740','76561197991651693','76561197991678275','76561197991754589','76561197991866728',
    '76561197991915984','76561197991963040','76561197992230198','76561197992337972','76561197992485147','76561197992517462',
    '76561197992816980','76561197992849415','76561197992862199','76561197993221750','76561197993350225','76561197993399102',
    '76561197993672815','76561197994162897','76561197994399633','76561197994746916','76561197994821082','76561197994974370',
    '76561197995176089','76561197995360419','76561197995581168','76561197995644952','76561197995721351','76561197996094340',
    '76561197996343337','76561197996528131','76561197996848155','76561197997437676','76561197997661465','76561197997877272',
    '76561197998120961','76561197998153038','76561197998513108','76561197998566553','76561197998882520','76561197998976137',
    '76561197999320977','76561197999559838','76561197999610648','76561197999845692','76561197999991191','76561198000256220',
    '76561198000282455','76561198000971666','76561198001492599','76561198002095700','76561198002357037','76561198002469533',
    '76561198002806294','76561198002992360','76561198003197624','76561198004049271','76561198004180185','76561198004274603',
    '76561198004429394','76561198004713083','76561198004727705','76561197992644082','76561197992684484','76561197992745652',
    '76561198004875238','76561198004978135','76561198004985423','76561198005319492','76561198005471010','76561198005511310',
    '76561198005652686','76561198005756844','76561198005828188','76561198005917132','76561198006012952','76561198006184016',
    '76561198006393498','76561198006423686','76561198006489197','76561198006570651','76561198006835753','76561198006851285',
    '76561198007503520','76561198007570550','76561198007796776','76561198007895286','76561198007943808','76561198007951319',
    '76561198008076359','76561198008452550','76561198008496002','76561198009064294','76561198009117461','76561198009194716',
    '76561198009476086','76561198009805209','76561198009938778','76561198010151984','76561198010507141','76561198010778422',
    '76561198010819567','76561198011127856','76561198011501645','76561198011960176','76561198012231622','76561198012392711',
    '76561198012627290','76561198012919357','76561198013196345','76561198013284957','76561198013372961','76561198013741690',
    '76561198015286141','76561198015792900','76561198016386321','76561198016421478','76561198016714551','76561198016793798',
    '76561198016818612','76561198017073543','76561198017296449','76561198017373226','76561198018267549','76561198018271377',
    '76561198018604414','76561198018868871','76561198019303353','76561198020223500','76561198020351916','76561198020663884',
    '76561198020753539','76561198021096301','76561198021141736','76561198021635058','76561198021796772','76561198023993859',
    '76561198024041514','76561198024187068','76561198024800184','76561198151870035','76561198206867913','76561198272860458',
    '76561198298390974','76561198444713592','76561198452105749','76561198774795057','76561198860387795','76561198879775327',
    '76561198911965133','76561198919378403','76561199025289700','76561199059059540','76561199060999111','76561199072309178',
    '76561199075560236','76561199083254755','76561199100226324','76561199101866977','76561199113179911','76561199120792873',
    '76561199131979202','76561199161066662','76561199167948219','76561198013771609','76561198013949783','76561198014918618',
    '76561199192242291','76561199202822726','76561199203228822','76561199207015773','76561199232222324','76561199244589544',
    '76561199316379549','76561199348672836','76561199353698802','76561199365154861','76561199369951583','76561199405676979',
    '76561199407499980','76561199433447445','76561199445504402','76561199465428109','76561199468573597','76561199471944646',
    '76561199496810936','76561199559552177','76561199560081532','76561199560211158','76561199560272076','76561199560361698',
    '76561199560633066','76561199560805836','76561199560934132','76561199560971801','76561199561010138','76561199561050248',
    '76561199561063517','76561199561113761','76561199561130351','76561199561249352','76561199561600590','76561199561634053',
    '76561199561645427','76561199561675810','76561199561729244','76561199561787549','76561199561841351','76561199562246233',
    '76561199562430329','76561199562517144','76561199825806095','76561199826468156','76561199826543701','76561199826576335',
    '76561199826637989','76561199826652248','76561199826681936','76561199826682670','76561199826720997','76561199826738682',
    '76561199826746469','76561199826767401','76561199826785822','76561199826789693','76561199826829431','76561199826845574',
    '76561199826862620','76561199826863578','76561199826876172','76561199826889440','76561199826890699','76561199826899068',
    '76561199826908652','76561199826909891','76561199827004461','76561199827004977','76561199827041538','76561199827056675',
    '76561199827072873','76561199827104798','76561199827111419','76561199827116705','76561199827117728','76561199827119163',
    '76561199827123222','76561199827126363','76561199827130402','76561199827138112','76561199827159314','76561199827159488',
    '76561199827170976','76561199827180907','76561199827189730','76561199827190004','76561199827215760','76561199827226881',
    '76561199827267940','76561199827285548','76561199827303721','76561199827324528','76561199827328058','76561199827329337',
    '76561199827332191','76561199827336590','76561199827337723','76561199827358042','76561199827360219','76561199827372901',
    '76561199827381187','76561199827381218','76561199827381662','76561199827387898','76561199827389434','76561199827396909',
    '76561199827405053','76561199827411443','76561199827415706','76561199827433514','76561199827436075','76561199827439553',
    '76561199827450406','76561199827482544','76561199827501148','76561199827501310','76561199827515838','76561199827520939',
    '76561199827526500','76561199827544494','76561199827545604','76561199827553201','76561199827556515','76561199827559229',
    '76561199827568815','76561199827571727','76561199827574382','76561199827583244','76561199827584624','76561199827590318',
    '76561199827590760','76561199827591579','76561199827594569','76561199827597463','76561199827598038','76561199827607060',
    '76561199827608500','76561199827609232','76561199827621072','76561199827245092','76561199827257213','76561199827262425',
    '76561199827623410','76561199827624400','76561199827632068','76561199827637674','76561199827645608','76561199827652557',
    '76561199827659339','76561199827668059','76561199827680240','76561199827687889','76561199827697731','76561199827700162',
    '76561199827706667','76561199827717639','76561199827725091','76561199827725582','76561199827735703','76561199827737305',
    '76561199827738816','76561199827775020','76561199827784573','76561199827803247','76561199827816351','76561199827820926',
    '76561199827827926','76561199827830295','76561199827838837','76561199827842829','76561199827843488','76561199827853301',
    '76561199827860991','76561199827866005','76561199827878665','76561199827881969','76561199827882355','76561199827917831',
    '76561199827922634','76561199827929770','76561199827933242','76561199827933488','76561199827963720','76561199827970978',
    '76561199827974652','76561199827975664','76561199827979933','76561199827984871','76561199827997766','76561199828001091',
    '76561199828030736','76561199828038551','76561199828039356','76561199828042491','76561199828044977','76561199828048126',
    '76561199828050470','76561199828052821','76561199828052888','76561199828055019','76561199828066369','76561199828087071',
    '76561199828092111','76561199828112819','76561199828115198','76561199828118148','76561199828127705','76561199828131673',
    '76561199828158167','76561199828161582','76561199828163542','76561199828166184','76561199828169829','76561199828179345',
    '76561199828190461','76561199828192185','76561199828203060','76561199828215714','76561199828219852','76561199828228377',
    '76561199828233468','76561199828236543','76561199828244884','76561199828248575','76561199828261856','76561199828262012',
    '76561199828266764','76561199828280794','76561199828284105','76561199828284661','76561199828299696','76561199828324805',
    '76561199828329181','76561199828350839','76561199828357844','76561199828372712','76561199828379303','76561199828381519',
    '76561199828385550','76561199828385595','76561199828389672','76561199828017953','76561199828025735','76561199828030440',
    '76561199828400180','76561199828406950','76561199828443094','76561199828448699','76561199828460342','76561199828470564',
    '76561199828479083','76561199828489756','76561199828501700','76561199828531928','76561199828537317','76561199828541414',
    '76561199828587734','76561199828603106','76561199828634396','76561199828649814','76561199828652081','76561199828678850',
    '76561199828697179','76561199828714282','76561199828734810','76561199828738055','76561199828753984','76561199828762930',
    '76561199828771469','76561199828809010','76561199828840323','76561199828847089','76561199828854290','76561199828860162',
    '76561199828863166','76561199828878569','76561199828886581','76561199828897721','76561199828905479','76561199829235149',
    '76561199829262808','76561199829350302','76561199829536418','76561197987794341','76561197987852194','76561197988289756',
    '76561197988525119','76561197989846446','76561197990198543','76561197990592745','76561197990997233','76561197991313381',
    '76561197992273780','76561197992340844','76561197992444625','76561197992583495','76561197992613082','76561197992670878',
    '76561197992789112','76561197993184958','76561197993204644','76561197993485850','76561197993662838','76561197993826617',
    '76561197993966698','76561197993980079','76561197993980361','76561197994026142','76561197994067621','76561197994242131',
    '76561197994264900','76561197994890994','76561197994897149','76561197994936681','76561197995051949','76561197995064714',
    '76561197995163860','76561197995197087','76561197995397470','76561197995413209','76561197995555409','76561197995700455',
    '76561197996005985','76561197996533380','76561197996669122','76561197997047431','76561197997920055','76561197998468439',
    '76561197998509095','76561197999169955','76561197999200727','76561197999309204','76561197999498116','76561197999570776',
    '76561197999790921','76561197999822567','76561198000007662','76561198000041198','76561198000074277','76561198000271076',
    '76561198000327822','76561198000412759','76561198000584886','76561197991410271','76561197991658749','76561197992026485',
    '76561198001025965','76561198001836862','76561198001851721','76561198002092164','76561198002289776','76561198002456339',
    '76561198002534583','76561198003165497','76561198003234354','76561198003641627','76561198003896590','76561198004165759',
    '76561198004216317','76561198005482461','76561198005578093','76561198005626607','76561198005729376','76561198005854934',
    '76561198005917638','76561198005986234','76561198005989136','76561198006487801','76561198006505594','76561198006593579',
    '76561198006620987','76561198006693993','76561198007101834','76561198007178143','76561198007898862','76561198007923170',
    '76561198007960588','76561198008214903','76561198008258685','76561198008393717','76561198008555259','76561198009046393',
    '76561198009099488','76561198009507546','76561198009917546','76561198009937883','76561198009964931','76561198010116882',
    '76561198010664826','76561198011195238','76561198011207909','76561198011383143','76561198011721239','76561198011944474',
    '76561198012755237','76561198012758124','76561198012763807','76561198012789350','76561198012795672','76561198013099354',
    '76561198013373828','76561198013449649','76561198013593877','76561198013684791','76561198013694203','76561198013793046',
    '76561198013993832','76561198014376585','76561198014505097','76561198014582086','76561198014782554','76561198014989143',
    '76561198015039552','76561198015040474','76561198015154051','76561198015792906','76561198015814357','76561198015827618',
    '76561198015959697','76561198015976672','76561198016687805','76561198016975761','76561198017316713','76561198017738334',
    '76561198017869245','76561198018024666','76561198018751114','76561198019133503','76561198019730760','76561198021131905',
    '76561198021137745','76561198024752010','76561198281142483','76561198297131030','76561198447386539','76561198883421931',
    '76561198890694530','76561198973362579','76561198999685535','76561199027486158','76561199077514099','76561199081270410',
    '76561199087369739','76561199089992090','76561199093599717','76561198012062927','76561198012463730','76561198012641643',
    '76561199095849532','76561199115192370','76561199139390196','76561199181089130','76561199183455866','76561199184696539',
    '76561199185661559','76561199190393784','76561199196500654','76561199205537592','76561199211100985','76561199223271155',
    '76561199225094297','76561199238404433','76561199246875334','76561199249247199','76561199270686085','76561199305031953',
    '76561199366544928','76561199380356076','76561199380519479','76561199382401879','76561199389709840','76561199403129885',
    '76561199407918006','76561199408934524','76561199417177707','76561199426202631','76561199429730704','76561199444767040',
    '76561199468734659',
    





]

DATA_FILE = 'friend_data.json'
INIT_FILE = '.initialized'

logging.basicConfig(level=logging.INFO, format='%(asctime)s - %(levelname)s - %(message)s')
logger = logging.getLogger("SteamFriendIDMonitor")

def get_profile_link(steam_id):
    """Generate Steam profile link from Steam ID"""
    return f"steamcommunity.com/profiles/{steam_id}"

async def fetch_friend_list(session, steam_id):
    """Fetch the complete friend list for a Steam account"""
    url = f"http://api.steampowered.com/ISteamUser/GetFriendList/v0001/?key={STEAM_API_KEY}&steamid={steam_id}&relationship=friend"
    profile_link = get_profile_link(steam_id)
    
    try:
        async with session.get(url, timeout=10) as resp:
            if resp.status == 200:
                data = await resp.json()
                friends_data = data.get('friendslist', {}).get('friends', [])
                # Extract just the Steam IDs of friends
                friend_ids = [friend['steamid'] for friend in friends_data]
                return steam_id, profile_link, friend_ids
            elif resp.status == 403:
                logger.warning(f"{profile_link} is private")
                return steam_id, profile_link, None
            else:
                logger.error(f"{profile_link}: API error {resp.status}")
                return steam_id, profile_link, None
    except Exception as e:
        logger.error(f"Error fetching {profile_link}: {e}")
        return steam_id, profile_link, None

async def send_telegram_message(message):
    """Send message to Telegram, splitting if too long"""
    MAX_MESSAGE_LENGTH = 4000  # Leave some buffer under 4096 limit
    
    if len(message) <= MAX_MESSAGE_LENGTH:
        await _send_single_message(message)
    else:
        # Split message into chunks
        lines = message.split('\n')
        current_chunk = ""
        
        for line in lines:
            # If adding this line would exceed limit, send current chunk
            if len(current_chunk + line + '\n') > MAX_MESSAGE_LENGTH:
                if current_chunk:
                    await _send_single_message(current_chunk.strip())
                    current_chunk = line + '\n'
                else:
                    # Single line is too long, truncate it
                    await _send_single_message(line[:MAX_MESSAGE_LENGTH])
            else:
                current_chunk += line + '\n'
        
        # Send remaining chunk
        if current_chunk:
            await _send_single_message(current_chunk.strip())

async def _send_single_message(message):
    """Send a single message to Telegram"""
    url = f"https://api.telegram.org/bot{TELEGRAM_BOT_TOKEN}/sendMessage"
    payload = {
        'chat_id': TELEGRAM_CHAT_ID,
        'text': message,
        'parse_mode': 'HTML'
    }
    async with aiohttp.ClientSession() as session:
        try:
            async with session.post(url, data=payload) as resp:
                if resp.status != 200:
                    logger.error(f"Failed to send message: {await resp.text()}")
                else:
                    logger.info("Telegram message sent successfully")
        except Exception as e:
            logger.error(f"Telegram error: {e}")

def load_previous_data():
    """Load previous friend data from file"""
    try:
        with open(DATA_FILE, 'r') as f:
            return json.load(f)
    except:
        return {}

def save_data(data):
    """Save friend data to file"""
    with open(DATA_FILE, 'w') as f:
        json.dump(data, f, indent=2)

def is_first_run():
    """Check if this is the first run of the bot"""
    if os.path.exists(INIT_FILE):
        return False
    with open(INIT_FILE, 'w') as f:
        f.write(datetime.now().isoformat())
    return True

async def check_accounts():
    """Main function to check all accounts for friend changes"""
    first_run = is_first_run()
    previous_data = load_previous_data()
    current_data = {}
    all_new_friends = []  # Collect all new friends for batched notification
    
    async with aiohttp.ClientSession() as session:
        tasks = [fetch_friend_list(session, steam_id) for steam_id in STEAM_ACCOUNTS]
        results = await asyncio.gather(*tasks)

    for steam_id, profile_link, friend_ids in results:
        if friend_ids is None:
            continue
            
        current_data[steam_id] = {
            'profile_link': profile_link,
            'friends': friend_ids,
            'count': len(friend_ids)
        }
        
        # Skip change detection on first run
        if first_run or steam_id not in previous_data:
            continue
            
        previous_friends = set(previous_data[steam_id].get('friends', []))
        current_friends = set(friend_ids)
        
        # Check for new friends only
        new_friends = current_friends - previous_friends
        if new_friends:
            for friend_id in new_friends:
                friend_profile_link = get_profile_link(friend_id)
                all_new_friends.append(friend_profile_link)
                logger.info(f"New friend detected: {friend_id} added to {steam_id}")
        
        # Log removed friends (no telegram notification)
        removed_friends = previous_friends - current_friends
        if removed_friends:
            for friend_id in removed_friends:
                logger.info(f"Friend removed: {friend_id} removed from {steam_id}")

    # Send batched notification for all new friends
    logger.info(f"Total new friends collected: {len(all_new_friends)}")
    logger.info(f"First run status: {first_run}")
    
    if all_new_friends and not first_run:
        if len(all_new_friends) == 1:
            msg = f"New friend: {all_new_friends[0]}"
        else:
            msg = f"New friends detected ({len(all_new_friends)}):\n\n"
            msg += "\n".join([f"â€¢ {friend_link}" for friend_link in all_new_friends])
        
        logger.info(f"Attempting to send Telegram message: {msg[:100]}...")
        await send_telegram_message(msg)
        logger.info(f"Sent batched notification for {len(all_new_friends)} new friends")
    elif all_new_friends and first_run:
        logger.info(f"New friends detected on first run (not sending notification): {len(all_new_friends)}")
    else:
        logger.info("No new friends detected in this cycle")

    # Save current data
    save_data(current_data)

    if first_run:
        # Log initial setup (no telegram messages)
        total_accounts = len(current_data)
        private_accounts = len(STEAM_ACCOUNTS) - total_accounts
        total_friends = sum(data['count'] for data in current_data.values())
        
        logger.info(f"Steam Friend ID Monitor Setup Complete")
        logger.info(f"Monitoring {total_accounts} accounts")
        logger.info(f"Total friends being tracked: {total_friends}")
        if private_accounts > 0:
            logger.info(f"{private_accounts} accounts are private")
        logger.info("Bot will now notify when specific friends are added with their Steam IDs")
    else:
        logger.info("Friend check completed")

if __name__ == '__main__':
    asyncio.run(check_accounts())

if __name__ == '__main__':
    asyncio.run(check_accounts())
