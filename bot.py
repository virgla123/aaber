import os
import json
import asyncio
import aiohttp
import logging
from datetime import datetime
import random
import time

# Configuration
TELEGRAM_BOT_TOKEN = os.environ.get('TELEGRAM_BOT_TOKEN', '')
TELEGRAM_CHAT_ID = os.environ.get('TELEGRAM_CHAT_ID', '')
STEAM_API_KEY = os.environ.get('STEAM_API_KEY', '')


STEAM_ACCOUNTS = [

    


'76561199820584143','76561199821974515','76561199820011011','76561199820880823','76561199821047811','76561199822030071',
'76561199821158128','76561199820383924','76561199821853111','76561199820433080','76561199821130113','76561199819782061',
'76561199820757415','76561199820291033','76561199820859536','76561199820201255','76561199820990816','76561199821130215',
'76561199820565482','76561199820517935','76561199821248240','76561199820146848','76561199820912402','76561199821169100',
'76561199821312612','76561199820826447','76561199821222738','76561199820621202','76561199822305459','76561199822756611',
'76561199822511621','76561199822322572','76561199821862720','76561199822556365','76561199822319669','76561199821385232',
'76561199823279515','76561199821638170','76561199821563617','76561199821333116','76561199822188121','76561199822383750',
'76561199822076816','76561199821504542','76561199821485174','76561199822250970','76561199821783496','76561199821549244',
'76561199821432754','76561199821798714','76561199821719578','76561199821407592','76561199822044576','76561199821810461',
'76561199822263571','76561199822049917','76561199821252483','76561199822569905','76561199822045176','76561199821874327',
'76561199821318737','76561199821817343','76561199822178187','76561199821464829','76561199821886152','76561199822335122',
'76561199822545289','76561199823033003','76561199821401996','76561199821052955','76561199821955314','76561199821406009',
'76561199822368107','76561199822916115','76561199821810110','76561199822105107','76561199822046854','76561199822297909',
'76561199821572871','76561199821301929','76561199822339011','76561199822109842','76561199822352429','76561199822467710',
'76561199822270322','76561199821721976','76561199822438406','76561199821715639','76561199821670757','76561199821702394',
'76561199822505864','76561199822540085','76561199822571994','76561199821094335','76561199821289185','76561199820253365',
'76561199821847734','76561199820803366','76561199820497323','76561199820754542','76561199821222611','76561199820303219',
'76561199820736015','76561199820680293','76561199823536973','76561199821736532','76561199821862393','76561199822153875',
'76561199822729534','76561199821861350','76561199821667698','76561199822143885','76561199821414656','76561199821665543',
'76561199823173209','76561199822619663','76561199821513227','76561199821549127','76561199821969647','76561199821991795',
'76561199822216873','76561199821765890','76561199822029647','76561199822198444','76561199821773980','76561199822194996',
'76561199822977924','76561199822207344','76561199821569547','76561199821182969','76561199822187289','76561199822677112',
'76561199822723992','76561199821556966','76561199822100343','76561199821367640','76561199820699384','76561199821142583',
'76561199820753750','76561199821222801','76561199820471284','76561199820768790','76561199821056040','76561199821140791',
'76561199820458528','76561199821372477','76561199820989775','76561199821223232','76561199821506787','76561199821111789',
'76561199819871338','76561199820219595','76561199820547066','76561199819847441','76561199821207401','76561199821188707',
'76561199820921041','76561199820388620','76561199820674423','76561199820856834','76561199820928224','76561199820495168',
'76561199820771667','76561199820858830','76561199821346420','76561199821376671','76561199822663794','76561199821999401',
'76561199821574748','76561199821022902','76561199821368735','76561199822530234','76561199821917752','76561199823059339',
'76561199821725904','76561199821946750','76561199822023152','76561199822320929','76561199821841169','76561199822177236',
'76561199822341908','76561199821107448','76561199822563875','76561199821824799','76561199821654491','76561199821021080',
'76561199821541257','76561199821339170','76561199821253433','76561199821904818','76561199821865341','76561199821399920',
'76561199822050279','76561199822744577','76561199821977694','76561199821635878','76561199821528972','76561199822558175',
'76561199821560988','76561199823368231','76561199821831093','76561199822255573','76561199821184522','76561199822477210',
'76561199822032272','76561199822331994','76561199822087557','76561199821665585','76561199821347790','76561199821811652',
'76561199823234531','76561199822589683','76561199821877551','76561199821756695','76561199821754586','76561199821703612',
'76561199823122406','76561199821774879','76561199823043934','76561199821491208','76561199822045156','76561199821923157',
'76561199821939142','76561199822771281','76561199821881357','76561199820632090','76561199822094483','76561199821851207',
'76561199821162710','76561199822587155','76561199821410170','76561199822332958','76561199821906825','76561199822667613',
'76561199821983008','76561199821758164','76561199822017641','76561199822415242','76561199821875986','76561199821990281',
'76561199822960253','76561199820943235','76561199822183858','76561199822714018','76561199822565174','76561199822202235',
'76561199821530126','76561199822555232','76561199822755615','76561199822038611','76561199822161318','76561199821814392',
'76561199822212315','76561199822547831','76561199822938624','76561199821458183','76561199821221755','76561199822150839',
'76561199822579699','76561199822008351','76561199821897605','76561199820063382','76561199821595842','76561199822160808',
'76561199822492863','76561199822058758','76561199821252334','76561199819873301','76561199820679245','76561199820435586',
'76561199821307644','76561199820472883','76561199820126532','76561199820475746','76561199821660469','76561199822435372',
'76561199820449243','76561199820482417','76561199820369478','76561199820015155','76561199821335136','76561199820363706',
'76561199820998109','76561199820126591','76561199820959373','76561199821084486','76561199821110805','76561199820992755',
'76561199820372615','76561199820665208','76561199821012516','76561199820047413','76561199821091342','76561199820878602',
'76561199821668801','76561199820392135','76561199820910610','76561199819969493','76561199821620634','76561199820324338',
'76561199820105355','76561199820416116','76561199820237644','76561199821546774','76561199821710377','76561199821783965',
'76561199820528390','76561199821933342','76561199820943797','76561199820806601','76561199819795065','76561199820751288',
'76561199820951615','76561199821207222','76561199820465608','76561199821093898','76561199821598521','76561199821542889',
'76561199820520676','76561199820067796','76561199821902630','76561199821512451','76561199820556467','76561199821339877',
'76561199820277559','76561199820962817','76561199820100983','76561199819990657','76561199820328759','76561199820549821',
'76561199820296552','76561199821475687','76561199821356967','76561199821070694','76561199821009657','76561199820491407',
'76561199821650973','76561199820743530','76561199820923165','76561199820565337','76561199820038229','76561199820417870',
'76561199820286344','76561199820489744','76561199821106467','76561199821607456','76561199820886258','76561199821716250',
'76561199820477050','76561199821644939','76561199822406877','76561199820556149','76561199821517844','76561199820568319',
'76561199821447241','76561199821046720','76561199821149939','76561199821029083','76561199820548097','76561199820909203',
'76561199820704914','76561199820057128','76561199820374004','76561199821211826','76561199819555737','76561199821139505',
'76561199821165976','76561199820588662','76561199821027463','76561199821174165','76561199821317896','76561199821204005',
'76561199821989708','76561199821497770','76561199821183505','76561199820461753','76561199820911581','76561199820994036',
'76561199820952766','76561199819809719','76561199820833127','76561199821166563','76561199820538279','76561199821832995',
'76561199821301308','76561199820349878','76561199820492291','76561199822157949','76561199821080567','76561199820594662',
'76561199820870970','76561199820962729','76561199820821367','76561199820396014','76561199820435942','76561199819825324',
'76561199821311208','76561199820495763','76561199820735117','76561199820578960','76561199820804819','76561199820783327',
'76561199820215770','76561199821104846','76561199821023722','76561199820757769','76561199820893585','76561199820883988',
'76561199821138235','76561199820887288','76561199820659403','76561199820880636','76561199820398520','76561199821225666',
'76561199821439433','76561199821194280','76561199821361748','76561199820968882','76561199820051723','76561199820404998',
'76561199821327697','76561199821589443','76561199821339654','76561199820426615','76561199820848520','76561199820575732',
'76561199820372757','76561199820764665','76561199821048047','76561199820573258','76561199820537837','76561199820275835',
'76561199821548067','76561199821783534','76561199821097028','76561199820283651','76561199820897632','76561199821096985',
'76561199820455203','76561199821770671','76561199820471150','76561199820133994','76561199820296205','76561199821420318',
'76561199820601019','76561199821112537','76561199821093533','76561199821334855','76561199820030599','76561199821041509',
'76561199820472565','76561199820185115','76561199820032754','76561199820568905','76561199820387796','76561199821234224',
'76561199821371632','76561199820577143','76561199820553100','76561199821500356','76561199820839712','76561199821191298',
'76561199821123534','76561199820494622','76561199820939641','76561199821197910','76561199820268881','76561199821363032',
'76561199819973671','76561199821179504','76561199821421271','76561199822039249','76561199821157982','76561199820996862',
'76561199821669486','76561199820222274','76561199820836264','76561199820530283','76561199820758491','76561199822749244',
'76561199821533323','76561199822250032','76561199822310408','76561199821973966','76561199820549395','76561199821484306',
'76561199822185448','76561199822028199','76561199822226276','76561199821295723','76561199822187798','76561199822191766',
'76561199822698324','76561199821884545','76561199820946502','76561199822957961','76561199821044271','76561199822269531',
'76561199821799908','76561199822541693','76561199821803234','76561199820829830','76561199822296362','76561199822761952',
'76561199821701954','76561199821483184','76561199821311064','76561199822173784','76561199821389847','76561199821226736',
'76561199821854715','76561199821304387','76561199822160161','76561199822034291','76561199822295594','76561199822396870',
'76561199822231739','76561199822386064','76561199821705930','76561199821780443','76561199821962721','76561199822000051',
'76561199820498394','76561199822133815','76561199821279786','76561199821528894','76561199821632896','76561199822181883',
'76561199822621013','76561199821945693','76561199822590072','76561199821556050','76561199822387512','76561199821265403',
'76561199821503197','76561199822734233','76561199823093774','76561199822072310','76561199822339996','76561199822046684',
'76561199821772692','76561199822630943','76561199821333643','76561199822408475','76561199822908598','76561199822338783',
'76561199823249454','76561199822499105','76561199821730579','76561199822057849','76561199821302177','76561199821844906',
'76561199822321868','76561199821987679','76561199822333855','76561199822252293','76561199822174839','76561199822132288',
'76561199821384515','76561199820373516','76561199821457974','76561199821086913','76561199821923866','76561199821010558',
'76561199822398814','76561199822322011','76561199821979049','76561199821417169','76561199822182554','76561199821920557',
'76561199821230217','76561199821969499','76561199821452843','76561199821221155','76561199822316096','76561199821732735',
'76561199822070105','76561199822023857','76561199821111133','76561199823011951','76561199821687266','76561199822066126',
'76561199821962781','76561199822314836','76561199822679360','76561199822029118','76561199822357034','76561199821627035',
'76561199822137306','76561199821810891','76561199821971692','76561199822323886','76561199822669785','76561199821802562',
'76561199822459059','76561199823271047','76561199821899916','76561199822302493','76561199822235342','76561199822092772',
'76561199821869919','76561199822185885','76561199821666405','76561199822074122','76561199822221546','76561199821782957',
'76561199822020607','76561199821225896','76561199822276982','76561199821401119','76561199821995804','76561199821658564',
'76561199823236686','76561199822304043','76561199821676287','76561199822199218','76561199821835767','76561199822077735',
'76561199821663856','76561199822281880','76561199821713076','76561199822755337','76561199822090903','76561199822081517',
'76561199821649944','76561199822818353','76561199823002469','76561199821038931','76561199821451519','76561199822086330',
'76561199822885271','76561199821769625','76561199822407666','76561199822775160','76561199821272952','76561199822427837',
'76561199821780326','76561199822479375','76561199822355787','76561199822047131','76561199822112186','76561199821682378',
'76561199821667466','76561199822389597','76561199822698317','76561199821498770','76561199821937334','76561199822759056',
'76561199821265530','76561199822593541','76561199821180212','76561199822759494','76561199820769493','76561199822472900',
'76561199821564426','76561199821484130','76561199821277940','76561199822063918','76561199822286581','76561199821677007',
'76561199821238268','76561199822276161','76561199821153921','76561199821224556','76561199821911568','76561199821193940',
'76561199821913629','76561199822363306','76561199822551941','76561199822844674','76561199821245029','76561199822069477',
'76561199823057466','76561199821624239','76561199821648345','76561199822943343','76561199821538656','76561199822503929',
'76561199822468141','76561199821513474','76561199821637242','76561199821871694','76561199821443045','76561199821680654',
'76561199822310783','76561199822434929','76561199822562157','76561199822883015','76561199821831617','76561199820899376',
'76561199821060397','76561199821965153','76561199821942166','76561199821896004','76561199821802277','76561199822403232',
'76561199822140939','76561199820911772','76561199822412090','76561199821869820','76561199821887261','76561199821720071',
'76561199822039317','76561199822593983','76561199822276295','76561199821713410','76561199822012753','76561199821875142',
'76561199822571548','76561199821307101','76561199822341886','76561199821494747','76561199821454736','76561199822468179',
'76561199821160101','76561199822032657','76561199821106586','76561199822043974','76561199822178005','76561199822502778',
'76561199820874378','76561199822256984','76561199821156933','76561199822067330','76561199821323305','76561199822005293',
'76561199821059439','76561199822151654','76561199821325320','76561199822039420','76561199821588948','76561199821506481',
'76561199821770232','76561199821998176','76561199821754574','76561199821478508','76561199821438271','76561199822114205',
'76561199822501366','76561199822306166','76561199822085820','76561199821674454','76561199821508857','76561199821960839',
'76561199821541688','76561199821753647','76561199821476979','76561199821477410','76561199822229594','76561199822888187',
'76561199821500878','76561199822360205','76561199822288335','76561199821967308','76561199822483039','76561199822575858',
'76561199822059003','76561199821515730','76561199821866902','76561199821444305','76561199823245827','76561199821502662',
'76561199822083466','76561199821773314','76561199821762024','76561199822215580','76561199821170736','76561199821780822',
'76561199821788912','76561199821217287','76561199821345577','76561199821301962','76561199821319928','76561199822322954',
'76561199821582483','76561199821852155','76561199821328970','76561199823051261','76561199821286218','76561199822488232',
'76561199822453462','76561199821370915','76561199821803191','76561199822085863','76561199822219386','76561199821036165',
'76561199821103357','76561199821743484','76561199822168763','76561199821671614','76561199822518307','76561199822205390',
'76561199821581794','76561199822373650','76561199821903496','76561199821693968','76561199821414438','76561199821460067',
'76561199821585174','76561199822387155','76561199821149571','76561199821461676','76561199821637899','76561199821810502',
'76561199821681748','76561199822015791','76561199822540837','76561199821193578','76561199822953256','76561199821539901',
'76561199822079411','76561199822285328','76561199821302186','76561199823177372','76561199822066161','76561199823053416',
'76561199821125677','76561199821432237','76561199822033349','76561199821702563','76561199821945363','76561199822220333',
'76561199821185389','76561199821729157','76561199822054583','76561199821904241','76561199821388828','76561199821598501',
'76561199822161614','76561199821853879','76561199821308195','76561199821495927','76561199821512918','76561199821624241',
'76561199822154460','76561199822536328','76561199822852432','76561199821407431','76561199821076284','76561199821971456',
'76561199822799260','76561199822421479','76561199822434027','76561199822529200','76561199822052209','76561199821897491',
'76561199821346587','76561199821533835','76561199822154891','76561199822185595','76561199822310278','76561199822420074',
'76561199821546666','76561199822184335','76561199821586191','76561199821402858','76561199822493614','76561199822145987',
'76561199822298440','76561199821256799','76561199821635571','76561199822278747','76561199821704118','76561199821917263',
'76561199822173635','76561199822698996','76561199821665725','76561199821473072','76561199821897343','76561199821099909',
'76561199821577409','76561199820671596','76561199822019552','76561199821263717','76561199823266306','76561199821751895',
'76561199822154534','76561199822353069','76561199822449858','76561199822029709','76561199822725285','76561199822753704',
'76561199822207098','76561199821673929','76561199821191421','76561199822721776','76561199823641631','76561199822745271',
'76561199822203097','76561199822228522','76561199821793111','76561199821711019','76561199822465512','76561199822472716',
'76561199821411000','76561199821882739','76561199821502171','76561199821788370','76561199822011338','76561199822627421',
'76561199821479680','76561199821666878','76561199821040935','76561199821384278','76561199822434637','76561199821573083',
'76561199821608538','76561199821078863','76561199821437135','76561199822021889','76561199822233592','76561199822747789',
'76561199822022735','76561199822274401','76561199822348583','76561199822761581','76561199822057198','76561199822326277',
'76561199822458326','76561199821263266','76561199822139522','76561199822828798','76561199821549989','76561199821948797',
'76561199821742546','76561199821866791','76561199821398922','76561199821992551','76561199821664835','76561199822655300',
'76561199821283396','76561199821982744','76561199822180018','76561199822595276','76561199821394431','76561199822034436',
'76561199822372343','76561199821850776','76561199822277218','76561199822849895','76561199822142325','76561199821201340',
'76561199820920392','76561199820891330','76561199821495803','76561199821738236','76561199821625597','76561199821272258',
'76561199822591064','76561199822196819','76561199822083173','76561199821965851','76561199823014509','76561199821820993',
'76561199822723351','76561199821050917','76561199823417331','76561199821171121','76561199821710231','76561199821122660',
'76561199821251146','76561199821769806','76561199821590821','76561199822604918','76561199821843811','76561199822400507',
'76561199821319497','76561199822111593','76561199821297308','76561199822328126','76561199821715281','76561199822323769',
'76561199822159831','76561199822595714','76561199821917077','76561199821028934','76561199822517980','76561199821557099',
'76561199822975004','76561199822089956','76561199822712725','76561199822722850','76561199822104670','76561199821537968',
'76561199821633007','76561199821859827','76561199822169745','76561199822160224','76561199821677810','76561199821448270',
'76561199822192029','76561199822478842','76561199822096831','76561199820802573','76561199822302193','76561199821976032',
'76561199822614218','76561199821655374','76561199821508701','76561199821665309','76561199822135754','76561199821930296',
'76561199822303355','76561199821924327','76561199822470130','76561199821419394','76561199821634225','76561199821262735',
'76561199821608845','76561199821111554','76561199821171263','76561199821533261','76561199823164873','76561199823346250',
'76561199821965210','76561199821209412','76561199822218960','76561199822427548','76561199821351348','76561199821594149',
'76561199822920522','76561199822098531','76561199821919796','76561199821830845','76561199821135894','76561199821041948',
'76561199821879672','76561199821719821','76561199821997656','76561199821608862','76561199822074089','76561199821522438',
'76561199821339257','76561199821091297','76561199822630997','76561199822466417','76561199822222016','76561199822361821',
'76561199822372635','76561199822569839','76561199821692295','76561199822417458','76561199822628983','76561199821674251',
'76561199822038093','76561199821899955','76561199821316261','76561199822112152','76561199821232792','76561199822172638',
'76561199821779397','76561199821400594','76561199821653898','76561199822306536','76561199821428973','76561199821501406',
'76561199822232611','76561199821471181','76561199821373349','76561199821644724','76561199821635941','76561199821983977',
'76561199821846028','76561199821061946','76561199823497677','76561199822204126','76561199821324323','76561199821917765',
'76561199821335004','76561199822709559','76561199821688026','76561199821110253','76561199821638798','76561199822503622',
'76561199822070128','76561199822253976','76561199823066321','76561199822291872','76561199821992027','76561199821535591',
'76561199821867042','76561199822456903','76561199822515135','76561199822047285','76561199822470253','76561199821017685',
'76561199821578255','76561199821686430','76561199821808549','76561199822027820','76561199822584132','76561199821316403',
'76561199822138788','76561199822121237','76561199821632695','76561199822101084','76561199821572009','76561199822368512',
'76561199821486422','76561199823486040','76561199821235378','76561199822021011','76561199821773320','76561199822050840',
'76561199821440467','76561199821968006','76561199821776090','76561199820921254','76561199822445824','76561199821877279',
'76561199822107283','76561199821619140','76561199822450880','76561199821504757','76561199822274272','76561199822155091',
'76561199821481079','76561199822048284','76561199822632192','76561199821601907','76561199821527450','76561199822214246',
'76561199822198896','76561198961887252','76561198962272913','76561198997113848','76561198911889498','76561198976142538',
'76561198997343981','76561199444389247','76561199442782771','76561199444839619','76561199444944019','76561199444468898',
'76561199446070340','76561199444540899','76561199443928688','76561199446294167','76561199444645033','76561199447065292',
'76561199444889707','76561199444840410','76561199444716226','76561199447518750','76561199446232999','76561199444943089',
'76561199446205669','76561199446479267','76561199441875716','76561199446343906','76561199445844411','76561199444003306',
'76561199442191611','76561199446047259','76561199445851652','76561199443734153','76561199442194438','76561199445930422',
'76561199443690916','76561199442261971','76561199444499535','76561199446418877','76561199443902451','76561199441202381',
'76561199444617684','76561199443153911','76561199443694808','76561199446471888','76561199444366617','76561199444681909',
'76561199444577450','76561199444103777','76561199446208704','76561199444196256','76561199439738460','76561199444284467',
'76561199444230354','76561199446283871','76561199444349328','76561199442058910','76561199446435609','76561199446144273',
'76561199444516434','76561199444737520','76561199447306987','76561199446132036','76561199444263495','76561199441784859',
'76561199446507186','76561199445966220','76561199446107873','76561199445780554','76561199443714406','76561199446201676',
'76561199444642002','76561199446045007','76561199446112036','76561199446450128','76561199444169390','76561199440737267',
'76561199446009473','76561199441263976','76561199444398946','76561199446120808','76561199444662536','76561199442080985',
'76561199446761578','76561199444530136','76561199444551379','76561199446024242','76561199447533690','76561199442449878',
'76561199446826054','76561199441161996','76561199446667755','76561199444793919','76561199442200406','76561199443603235',
'76561199447189293','76561199444728195','76561199445919644','76561199444892193','76561199444431566','76561199445958603',
'76561199445930636','76561199445740777','76561199441430218','76561199446731422','76561199446594540','76561199444174246',
'76561199446140058','76561199444993301','76561199446375064','76561199444796742','76561199444953321','76561199442352784',
'76561199443036102','76561199439756006','76561199446896480','76561199444401551','76561199441115744','76561199444967724',
'76561199443471133','76561199446718054','76561199444726139','76561199445523162','76561199445967318','76561199442000734',
'76561199444657082','76561199441002512','76561199444724562','76561199444338513','76561199447153045','76561199444160807',
'76561199446306943','76561199444161744','76561199444047223','76561199446039209','76561199446143588','76561199442495343',
'76561199446139548','76561199446219247','76561199442123723','76561199444670368','76561199446474839','76561199442409655',
'76561199446059063','76561199446092288','76561199446188301','76561199442248360','76561199446323239','76561199446052832',
'76561199446086951','76561199446380733','76561199445885672','76561199446286745','76561199444343807','76561199444393557',
'76561199446937139','76561199441762252','76561199445118683','76561199443983772','76561199446057992','76561199444565446',
'76561199445797811','76561199445908047','76561199444657605','76561199444311131','76561199441324867','76561199446808599',
'76561199444600993','76561199444144547','76561199442142662','76561199444271505','76561199444416274','76561199442500775',
'76561199444434518','76561199446017620','76561199444353816','76561199442649737','76561199441172548','76561199444742847',
'76561199444870602','76561199446404169','76561199441229242','76561199446181009','76561199442279879','76561199446160687',
'76561199442223117','76561199444760878','76561199441507085','76561199446029521','76561199439977444','76561199446301893',
'76561199446579648','76561199443806299','76561199214336267','76561199444348968','76561199444638992','76561199446107060',
'76561199444602798','76561199447128452','76561199444972932','76561199444836390','76561199445606676','76561199442562484',
'76561199444545498','76561199446015875','76561199443952698','76561199444056970','76561199442235410','76561199446362995',
'76561199445454550','76561199442790231','76561199444363232','76561199445640745','76561199444139633','76561199442836565',
'76561199443959891','76561199444775875','76561199446190154','76561199446525161','76561199442598809','76561199444718522',
'76561199446853534','76561199443435297','76561199447250466','76561199441570343','76561199446821418','76561199446788265',
'76561199442583603','76561199443647589','76561199444194931','76561199446401277','76561199446972740','76561199446540942',
'76561199442147488','76561199444289516','76561199441911241','76561199444920271','76561199446387087','76561199444344092',
'76561199445310273','76561199444775501','76561199443662475','76561199442099992','76561199444805017','76561199447401710',
'76561199446513609','76561199444478824','76561199439633643','76561199443980198','76561199444627515','76561199445651505',
'76561199444854854','76561199446135784','76561199444429057','76561199446624991','76561199444150387','76561199443926759',
'76561199444189839','76561199445870172','76561199444699375','76561199443833062','76561199446366472','76561199444862672',
'76561199444417324','76561199444250988','76561199443872432','76561199445762998','76561199446415521','76561199446192141',
'76561199444485364','76561199441935148','76561199444408423','76561199444305422','76561199445556776','76561199446218539',
'76561199442395515','76561199437708525','76561199441310091','76561199444052624','76561199441808439','76561199441542613',
'76561199440277058','76561199444792536','76561199446453762','76561199440119957','76561199438111016','76561199446300939',
'76561199441373233','76561199440231150','76561199447234238','76561199445855603','76561199445884410','76561199441485487',
'76561199444124106','76561199445950111','76561199445539971','76561199441209690','76561199441150952','76561199440807039',
'76561199443962747','76561199446316083','76561199439440174','76561199444551719','76561199439675727','76561199440691493',
'76561199440309639','76561199440570219','76561199439924767','76561199441076907','76561199440807583','76561199445871902',
'76561199214608128','76561199439435425','76561199439988682','76561199440111188','76561199440051721','76561199440392445',
'76561199441744202','76561199444641708','76561199441494186','76561199441685467','76561199440074202','76561199443941157',
'76561199444951278','76561199446477265','76561199441014709','76561199441486611','76561199440244426','76561199444013787',
'76561199446273337','76561199445905495','76561199439294368','76561199444261987','76561199445026333','76561199440879776',
'76561199440855098','76561199441854403','76561199440534862','76561199446417029','76561199444809799','76561199445801350',
'76561199441898971','76561199442052908','76561199445788692','76561199445655602','76561199440421211','76561199440818368',
'76561199440118206','76561199440490573','76561199440272294','76561199438793189','76561199440555962','76561199440131388',
'76561199446523738','76561199440858832','76561199440571100','76561199444192727','76561199444647128','76561199444464123',
'76561199446197165','76561199446100751','76561199440101512','76561199446331486','76561199441909995','76561199446033626',
'76561199444433246','76561199447053851','76561199439824901','76561199444367164','76561199439931145','76561199442464340',
'76561199440088045','76561199446297981','76561199440711876','76561199441277843','76561199439664663','76561199441899116',
'76561199445871756','76561199447116285','76561199444727379','76561199440929749','76561199439686656','76561199440470231',
'76561199439068182','76561199440199061','76561199440313385','76561199440547655','76561199440561198','76561199438061390',
'76561199439976477','76561199444775623','76561199440240405','76561199440439851','76561199446431831','76561199440211865',
'76561199440061745','76561199439823548','76561199440048029','76561199440201559','76561199446443902','76561199438685544',
'76561199443818335','76561199439625199','76561199445851794','76561199444759644','76561199447139512','76561199446472382',
'76561199441552553','76561199441735381','76561199446606150','76561199446719471','76561199444940424','76561199439816164',
'76561199446127342','76561199444686844','76561199438369416','76561199439876495','76561199446135603','76561199444879323',
'76561199439806481','76561199439911115','76561199441588745','76561199440078267','76561199442362303','76561199446399104',
'76561199445811832','76561199439901124','76561199439830330','76561199444644208','76561199438802875','76561199438826185',
'76561199440218480','76561199439554615','76561199440319271','76561199440664945','76561199440407618','76561199444743158',
'76561199445001205','76561199440597304','76561199439991570','76561199438108334','76561199440972454','76561199438598894',
'76561199439999275','76561199440067683','76561199446357206','76561199440428076','76561199440558991','76561199441019075',
'76561199446296905','76561199444627748','76561199439080636','76561199444334486','76561199440536944','76561199446109674',
'76561199440463140','76561199446155190','76561199446508402','76561199441808485','76561199446203349','76561199441066207',
'76561199444957097','76561199444575364','76561199444013727','76561199441135191','76561199439547112','76561199441328611',
'76561199445919127','76561199446050172','76561199444606210','76561199439236590','76561199445912596','76561199446684843',
'76561199444597464','76561199444879826','76561199444881096','76561199440145845','76561199446618994','76561199446342950',
'76561199439973580','76561199446780323','76561199440065958','76561199440351432','76561199439514027','76561199440410105',
'76561199439400729','76561199440360865','76561199440192518','76561199439771378','76561199440514917','76561199440595982',
'76561199440063385','76561199444521035','76561199440025640','76561199439595709','76561199439943190','76561199445985129',
'76561199444550486','76561199447702705','76561199446081907','76561199446077408','76561199444901911','76561199446024443',
'76561199444803660','76561199446127718','76561199441741682','76561199441565613','76561199440411195','76561199440698422',
'76561199444950324','76561199440344077','76561199446237171','76561199439404179','76561199439842564','76561199440060386',
'76561199440258689','76561199446073297','76561199441007308','76561199441450060','76561199446120621','76561199440582185',
'76561199446504124','76561199444249280','76561199444734241','76561199441726809','76561199438228201','76561199440374465',
'76561199441169039','76561199444529661','76561199446025360','76561199444037422','76561199440868292','76561199445577395',
'76561199444539316','76561199445023316','76561199439962787','76561199439279209','76561199440798375','76561199440438213',
'76561199440382488','76561199440018246','76561199440713008','76561199440822804','76561199440484934','76561199440789909',
'76561199444326738','76561199438894662','76561199440455343','76561199440276424','76561199439665177','76561199446207888',
'76561199441560316','76561199444828619','76561199445792342','76561199444462863','76561199447312338','76561199444835097',
'76561199441409798','76561199446658264','76561199438607211','76561199442304198','76561199446140106','76561199446103041',
'76561199444416731','76561199446019707','76561199444379179','76561199444120845','76561199439585039','76561199444320613',
'76561199441554627','76561199444574660','76561199443874515','76561199446261513','76561199442529489','76561199440087019',
'76561199445798673','76561199444293941','76561199441224311','76561199446208660','76561199439354044','76561199439807769',
'76561199439103707','76561199440755253','76561199446425400','76561199439909037','76561199438996468','76561199445907182',
'76561199440596806','76561199439719786','76561199439668427','76561199438709460','76561199439172645','76561199440784556',
'76561199439894112','76561199441140944','76561199438789738','76561199442448669','76561199446254681','76561199446042193',
'76561199446231109','76561199443973489','76561199439985714','76561199445960357','76561199444728694','76561199439630133',
'76561199446062749','76561199447107349','76561199444284725','76561199441823829','76561199444967727','76561199444602502',
'76561199444643781','76561199446166853','76561199441464951','76561199438241078','76561199446161477','76561199443912614',
'76561199444725967','76561199441222408','76561199445614965','76561199439180342','76561199181789646','76561199163225127',
'76561199022756659','76561199029776791','76561199029564579','76561199022665789','76561197962381736','76561199022970210',
'76561199029781721','76561199022768479','76561199029812856','76561199218276720','76561199058733347','76561199029781820',
'76561199029942477','76561199030123083','76561199022656990','76561199030042426','76561199022654968','76561199030347700',
'76561199022768153','76561199022513540','76561199022442995','76561199029879342','76561199029721135','76561199022579856',
'76561199022884575','76561199022681096','76561199022593811','76561199030014614','76561199022949077','76561199022262622',
'76561199029877372','76561199022795696','76561199163118390','76561199181047752','76561199180723677','76561199163042790',
'76561199181658638','76561199163293823','76561199180914669','76561199180293374','76561199180301936','76561199180575529',
'76561199180074680','76561199162987353','76561199163016229','76561199180110020','76561199181252927','76561199163378033',
'76561199181095739','76561199022736855','76561199022667379','76561199022743861','76561199029869632','76561199029730634',
'76561199022409443','76561199029918017','76561199029700841','76561199029461179','76561199030067554','76561199029653765',
'76561199059739311','76561199059807831','76561199059652389','76561199059903578','76561199059550138','76561199059836059',
'76561199058455450','76561199059713057','76561199058503662','76561199059858649','76561199059586186','76561199059669370',
'76561199059891247','76561199059757895','76561199059803459','76561199059676128','76561199058601489','76561199058531132',
'76561199059762168','76561199059635846','76561199058545869','76561199058466975','76561199059948676','76561199058621832',
'76561199058495742','76561199058569618','76561199059889593','76561199059609261','76561199058536922','76561199059710308',
'76561199058484416','76561199058502621','76561199058423530','76561199059900605','76561199161424512','76561199163025078',
'76561199162517256','76561199058521413','76561199059921606','76561199058455145','76561199059674528','76561199059730792',
'76561199059564573','76561199114525749',

    
    #NAVI #KINGSLAYER
    
    
]


DATA_FILE = 'friend_data.json'
INIT_FILE = '.initialized'

# Optimized rate limiting configuration for speed
MAX_CONCURRENT_REQUESTS = 50  # High concurrency
REQUEST_DELAY = 0.1  # Very short delay between requests
BURST_SIZE = 100  # Allow bursts of requests
BURST_DELAY = 5  # Pause after each burst
MAX_RETRIES = 2  # Limit retries to keep speed up

logging.basicConfig(level=logging.INFO, format='%(asctime)s - %(levelname)s - %(message)s')
logger = logging.getLogger("SteamFriendIDMonitor")

class FastRateLimiter:
    def __init__(self, max_concurrent=50, burst_size=100, burst_delay=5):
        self.semaphore = asyncio.Semaphore(max_concurrent)
        self.burst_size = burst_size
        self.burst_delay = burst_delay
        self.request_count = 0
        self.last_burst_reset = None
        self.loop = None
    
    async def acquire(self):
        if self.loop is None:
            self.loop = asyncio.get_event_loop()
            self.last_burst_reset = self.loop.time()
        
        await self.semaphore.acquire()
        
        # Check if we need to pause after a burst
        self.request_count += 1
        if self.request_count >= self.burst_size:
            current_time = self.loop.time()
            time_since_reset = current_time - self.last_burst_reset
            
            if time_since_reset < self.burst_delay:
                sleep_time = self.burst_delay - time_since_reset
                logger.debug(f"Burst limit reached, sleeping for {sleep_time:.2f}s")
                await asyncio.sleep(sleep_time)
            
            self.request_count = 0
            self.last_burst_reset = self.loop.time()
        
        # Small delay to prevent hammering
        await asyncio.sleep(0.05 + random.uniform(0, 0.05))
    
    def release(self):
        self.semaphore.release()

# Rate limiter will be created inside the main function

def get_profile_link(steam_id):
    """Generate Steam profile link from Steam ID"""
    return f"steamcommunity.com/profiles/{steam_id}"

async def fetch_friend_list(session, steam_id, rate_limiter, retry_count=0):
    """Fetch the complete friend list for a Steam account with optimized rate limiting"""
    url = f"http://api.steampowered.com/ISteamUser/GetFriendList/v0001/?key={STEAM_API_KEY}&steamid={steam_id}&relationship=friend"
    profile_link = get_profile_link(steam_id)
    
    await rate_limiter.acquire()
    try:
        async with session.get(url, timeout=10) as resp:
            if resp.status == 200:
                data = await resp.json()
                friends_data = data.get('friendslist', {}).get('friends', [])
                friend_ids = [friend['steamid'] for friend in friends_data]
                return steam_id, profile_link, friend_ids
            elif resp.status == 403:
                logger.debug(f"{profile_link} is private")
                return steam_id, profile_link, None
            elif resp.status in [429, 420]:
                if retry_count < MAX_RETRIES:
                    # Exponential backoff for rate limits
                    delay = (2 ** retry_count) + random.uniform(0, 1)
                    logger.warning(f"{profile_link}: Rate limited, retrying in {delay:.2f}s")
                    await asyncio.sleep(delay)
                    return await fetch_friend_list(session, steam_id, rate_limiter, retry_count + 1)
                else:
                    logger.error(f"{profile_link}: Max retries exceeded for rate limit")
                    return steam_id, profile_link, None
            else:
                logger.warning(f"{profile_link}: API error {resp.status}")
                return steam_id, profile_link, None
    except asyncio.TimeoutError:
        logger.warning(f"Timeout fetching {profile_link}")
        return steam_id, profile_link, None
    except Exception as e:
        logger.warning(f"Error fetching {profile_link}: {e}")
        return steam_id, profile_link, None
    finally:
        rate_limiter.release()

async def send_telegram_message(message):
    """Send message to Telegram, splitting if too long"""
    MAX_MESSAGE_LENGTH = 4000
    
    if len(message) <= MAX_MESSAGE_LENGTH:
        await _send_single_message(message)
    else:
        lines = message.split('\n')
        current_chunk = ""
        
        for line in lines:
            if len(current_chunk + line + '\n') > MAX_MESSAGE_LENGTH:
                if current_chunk:
                    await _send_single_message(current_chunk.strip())
                    current_chunk = line + '\n'
                else:
                    await _send_single_message(line[:MAX_MESSAGE_LENGTH])
            else:
                current_chunk += line + '\n'
        
        if current_chunk:
            await _send_single_message(current_chunk.strip())

async def _send_single_message(message):
    """Send a single message to Telegram"""
    url = f"https://api.telegram.org/bot{TELEGRAM_BOT_TOKEN}/sendMessage"
    payload = {
        'chat_id': TELEGRAM_CHAT_ID,
        'text': message,
        'parse_mode': 'HTML'
    }
    async with aiohttp.ClientSession() as session:
        try:
            async with session.post(url, data=payload) as resp:
                if resp.status != 200:
                    logger.error(f"Failed to send message: {await resp.text()}")
                else:
                    logger.info("Telegram message sent successfully")
        except Exception as e:
            logger.error(f"Telegram error: {e}")

def load_previous_data():
    """Load previous friend data from file"""
    try:
        with open(DATA_FILE, 'r') as f:
            return json.load(f)
    except:
        return {}

def save_data(data):
    """Save friend data to file"""
    with open(DATA_FILE, 'w') as f:
        json.dump(data, f, indent=2)

def is_first_run():
    """Check if this is the first run of the bot"""
    if os.path.exists(INIT_FILE):
        return False
    with open(INIT_FILE, 'w') as f:
        f.write(datetime.now().isoformat())
    return True

async def check_accounts():
    """Main function to check all accounts for friend changes - optimized for speed"""
    start_time = time.time()
    first_run = is_first_run()
    previous_data = load_previous_data()
    current_data = {}
    all_new_friends = []
    
    # Create rate limiter inside the async function
    rate_limiter = FastRateLimiter(MAX_CONCURRENT_REQUESTS, BURST_SIZE, BURST_DELAY)
    
    logger.info(f"Starting fast check for {len(STEAM_ACCOUNTS)} accounts...")
    
    # Optimized session configuration for high throughput
    connector = aiohttp.TCPConnector(
        limit=200,  # High connection pool
        limit_per_host=100,  # High per-host limit
        ttl_dns_cache=300,  # DNS cache
        use_dns_cache=True,
        keepalive_timeout=30,
        enable_cleanup_closed=True
    )
    
    timeout = aiohttp.ClientTimeout(total=15, connect=5)
    
    async with aiohttp.ClientSession(
        connector=connector, 
        timeout=timeout,
        headers={'User-Agent': 'SteamFriendMonitor/1.0'}
    ) as session:
        
        # Create all tasks at once for maximum concurrency
        tasks = [fetch_friend_list(session, steam_id, rate_limiter) for steam_id in STEAM_ACCOUNTS]
        
        # Progress tracking
        completed = 0
        total = len(tasks)
        
        # Process all requests concurrently with progress updates
        for coro in asyncio.as_completed(tasks):
            try:
                steam_id, profile_link, friend_ids = await coro
                completed += 1
                
                # Progress update every 500 accounts
                if completed % 500 == 0 or completed == total:
                    elapsed = time.time() - start_time
                    rate = completed / elapsed
                    eta = (total - completed) / rate if rate > 0 else 0
                    logger.info(f"Progress: {completed}/{total} ({completed/total*100:.1f}%) - {rate:.1f} req/s - ETA: {eta:.1f}s")
                
                if friend_ids is None:
                    continue
                    
                current_data[steam_id] = {
                    'profile_link': profile_link,
                    'friends': friend_ids,
                    'count': len(friend_ids)
                }
                
                # Skip change detection on first run
                if first_run or steam_id not in previous_data:
                    continue
                    
                previous_friends = set(previous_data[steam_id].get('friends', []))
                current_friends = set(friend_ids)
                
                # Check for new friends only
                new_friends = current_friends - previous_friends
                if new_friends:
                    for friend_id in new_friends:
                        friend_profile_link = get_profile_link(friend_id)
                        all_new_friends.append(friend_profile_link)
                        logger.info(f"New friend detected: {friend_id} added to {steam_id}")
                
                # Log removed friends (no telegram notification)
                removed_friends = previous_friends - current_friends
                if removed_friends:
                    for friend_id in removed_friends:
                        logger.debug(f"Friend removed: {friend_id} removed from {steam_id}")
                        
            except Exception as e:
                logger.error(f"Error processing task: {e}")
                completed += 1

    total_time = time.time() - start_time
    successful_accounts = len(current_data)
    avg_rate = successful_accounts / total_time if total_time > 0 else 0
    
    logger.info(f"Completed in {total_time:.2f}s - {avg_rate:.1f} accounts/sec - {successful_accounts}/{len(STEAM_ACCOUNTS)} successful")

    # Send batched notification for all new friends
    logger.info(f"Total new friends collected: {len(all_new_friends)}")
    
    if all_new_friends and not first_run:
        if len(all_new_friends) == 1:
            msg = f"New friend: {all_new_friends[0]}"
        else:
            msg = f"New friends detected ({len(all_new_friends)}):\n\n"
            msg += "\n".join([f"• {friend_link}" for friend_link in all_new_friends])
        
        logger.info(f"Sending Telegram notification for {len(all_new_friends)} new friends")
        await send_telegram_message(msg)
    elif all_new_friends and first_run:
        logger.info(f"New friends detected on first run (not sending notification): {len(all_new_friends)}")
    else:
        logger.info("No new friends detected in this cycle")

    # Save current data
    save_data(current_data)

    if first_run:
        total_accounts = len(current_data)
        private_accounts = len(STEAM_ACCOUNTS) - total_accounts
        total_friends = sum(data['count'] for data in current_data.values())
        
        logger.info(f"Steam Friend ID Monitor Setup Complete")
        logger.info(f"Monitoring {total_accounts} accounts")
        logger.info(f"Total friends being tracked: {total_friends}")
        if private_accounts > 0:
            logger.info(f"{private_accounts} accounts are private")
        logger.info("Bot will now notify when specific friends are added with their Steam IDs")
    else:
        logger.info(f"Friend check completed. Successfully processed {successful_accounts} accounts in {total_time:.2f}s")

if __name__ == '__main__':
    asyncio.run(check_accounts())
